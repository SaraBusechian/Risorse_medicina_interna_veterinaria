<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riassunto: Esame Apparato Digerente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; line-height: 1.6; color: #333; background-color: #f8fafc; }
        h1, h2, h3 { color: #0d47a1; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px; margin-top: 2em; }
        h3 { color: #1565c0; border-bottom: none; font-weight: 600; } /* Stile per H3 */
        h1 { text-align: center; font-size: 2.2em; border-bottom: 3px solid #0d47a1; }
        ul { padding-left: 20px; list-style-type: disc; }
        li { margin-bottom: 10px; }
        strong { color: #1565c0; }
        .section-block { background-color: #f9f9f9; border-left: 5px solid #1e88e5; padding: 15px 20px; margin: 20px 0; border-radius: 5px; }
        .nav-link { transition: color 0.3s; }
        .nav-link:hover { color: #93C5FD; }
        .dsa-mode {
            font-family: 'Lexend', sans-serif;
            background-color: #fdfaf5 !important;
            letter-spacing: 0.05em;
            line-height: 1.75;
        }
        .dsa-mode #main-header, .dsa-mode #main-footer {
            background-color: #000000 !important;
            background-image: none !important;
        }
        .dsa-mode #main-header h1, .dsa-mode #main-header .nav-link, .dsa-mode #main-footer p, .dsa-mode #accessibility-toggle, .dsa-mode #lang-toggle {
            color: #ffffff !important;
        }
        .dsa-mode #accessibility-toggle, .dsa-mode #lang-toggle { border: 1px solid #ffffff; }
        .dsa-mode #main-content { background-color: #fffdfa; border: 1px solid #e0e0e0; }
        .dsa-mode h1, .dsa-mode h2, .dsa-mode h3, .dsa-mode p, .dsa-mode li { color: #34495e; }
        .tts-button {
            cursor: pointer;
            display: inline-block;
            margin-left: 10px;
            vertical-align: middle;
            color: #64748b;
            transition: color 0.2s;
        }
        .tts-button:hover { color: #0ea5e9; }
        .tts-button.playing { color: #0ea5e9; }
        @media print {
            #main-header, #main-footer, #print-button, .tts-button { display: none; }
            body { margin: 0; padding: 0; }
            .container { max-width: 100%; padding: 20px; box-shadow: none; border: none; }
        }
    </style>
</head>
<body class="bg-slate-50">

    <header id="main-header" class="bg-[#1E3A8A] text-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center flex-wrap">
            <h1 class="text-xl font-bold !text-white !border-none !m-0 !p-0 !text-left" data-lang-key="siteTitle">Semeiotica Vet G.A.</h1>
            <div class="flex items-center space-x-4">
                 <a href="esame_obiettivo.html" class="nav-link font-semibold" data-lang-key="navBack">Indice Esami</a>
                <button id="accessibility-toggle" aria-label="Attiva modalità ad alta leggibilità" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition" data-lang-key="accessibility">Accessibilità</button>
                <button id="lang-toggle" aria-label="Change language" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition">EN</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-10">
        <div id="main-content" class="bg-white rounded-xl shadow-lg p-6 md:p-10">
            <h1 data-lang-key="pageTitle"></h1>
            <p class="section-block" data-lang-key="introText"></p>
    
            <div data-lang-key="sectionIspezione"></div>
            <div data-lang-key="sectionPalpazione"></div>
            <div data-lang-key="sectionPercussione"></div>
            <div data-lang-key="sectionAuscultazione"></div>
            <div data-lang-key="sectionComplementari"></div>
    
            <div class="mt-12 text-center">
                <button id="print-button" onclick="window.print()" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition duration-300 inline-flex items-center" data-lang-key="btnPrint">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M5 4v3h10V4H5zm11 9H4v4h12v-4zM5 11h10v-3H5v3z"></path><path fill-rule="evenodd" d="M18 8H2a2 2 0 00-2 2v4a2 2 0 002 2h2v2a2 2 0 002 2h8a2 2 0 002-2v-2h2a2 2 0 002-2v-4a2 2 0 00-2-2zM4 10a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zm1 5a1 1 0 100 2h8a1 1 0 100-2H5z" clip-rule="evenodd"></path></svg>
                    Stampa
                </button>
            </div>
        </div>
    </main>
    
    <footer id="main-footer" class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-6 py-4 text-center">
            <p data-lang-key="footerText">&copy; 2024 Semeiotica Veterinaria. Creato da Sara Busechian.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const speakerIconLarge = `<span class="tts-button"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span>`;
            const speakerIconSmall = `<span class="tts-button"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span>`;
            const speakerIconH2 = `<span class="tts-button"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span>`;
            
            const translations = {
                siteTitle: { it: 'Semeiotica Vet G.A.', en: 'Veterinary Semeiotics L.A.' },
                navBack: { it: 'Indice Esami', en: 'Exams Index' },
                accessibility: { it: 'Accessibilità', en: 'Accessibility' },
                pageTitle: { it: `Esame dell'Apparato Digerente ${speakerIconLarge}`, en: `Examination of the Digestive System ${speakerIconLarge}` },
                introText: { it: `L'esame dell'apparato digerente nei grandi animali è complesso e richiede un approccio sistematico che integri le metodiche semeiotica classiche con manovre specifiche, soprattutto nei ruminanti e nel cavallo, data la particolare anatomia e fisiologia. ${speakerIconSmall}`, en: `The examination of the digestive system in large animals is complex and requires a systematic approach that integrates classic semeiotics methods with specific maneuvers, especially in ruminants and horses, given their particular anatomy and physiology. ${speakerIconSmall}` },
                
                sectionIspezione: { 
                    it: `<h2>1. Ispezione${speakerIconH2}</h2>
                         <p>La valutazione visiva si concentra sull'addome, sulla cavità orale e sulle feci.</p>
                         <ul>
                            <li><strong>Addome:</strong> Valutare forma, volume e simmetria (es. gonfiore localizzato o diffuso, profilo "a bisaccia" per aumento dei diametri trasversi ventrali dovuto a versamento peritoneale). Osservare atteggiamenti antalgici.</li>
                            <li><strong>Cavità Orale:</strong> Ispezionare lingua, denti, gengive, palato per lesioni, corpi estranei, usura anomala dei denti, colore delle mucose. Valutare la salivazione (quantità, aspetto).</li>
                            <li><strong>Feci:</strong> Osservare consistenza, colore, odore, presenza di sangue, muco, parassiti o materiale indigerito.</li>
                         </ul>`,
                    en: `<h2>1. Inspection${speakerIconH2}</h2>
                         <p>Visual assessment focuses on the abdomen, oral cavity, and feces.</p>
                         <ul>
                            <li><strong>Abdomen:</strong> Assess shape, volume, and symmetry (e.g., localized or diffuse swelling, "pear-shaped" profile due to increased ventral transverse diameters from peritoneal effusion). Observe signs of pain.</li>
                            <li><strong>Oral Cavity:</strong> Inspect tongue, teeth, gums, palate for lesions, foreign bodies, abnormal tooth wear, mucous membrane color. Assess salivation (amount, appearance).</li>
                            <li><strong>Feces:</strong> Observe consistency, color, odor, presence of blood, mucus, parasites, or undigested material.</li>
                         </ul>`
                },
                sectionPalpazione: { 
                    it: `<h2>2. Palpazione${speakerIconH2}</h2>
                         <p>Comprende sia la palpazione esterna dell'addome che l'esplorazione rettale (fondamentale nei grandi animali).</p>
                         <ul>
                            <li><strong>Palpazione Addominale Esterna:</strong> Eseguita con pressione graduale su fianchi e ventralmente. Si valuta la dolorabilità ("guaiac test" nel bovino), la tensione della parete, la presenza di masse superficiali.</li>
                            <li><strong>Esplorazione Rettale:</strong> Manovra cruciale nel bovino e nel cavallo. Permette di valutare:
                                <ul>
                                    <li><strong>Bovino:</strong> Riempimento e stratificazione del rumine, posizione e consistenza di reticolo, omaso, abomaso, anse intestinali, linfonodi iliaci interni, reni, vescica, apparato genitale.</li>
                                    <li><strong>Cavallo:</strong> Cieco, Grosso Colon (tenie, sacculazioni), Piccolo Colon (scibale), radice del mesentere, milza, rene sinistro e destro, vescica, anello inguinale interno (maschio), apparato genitale (femmina).</li>
                                </ul>
                             </li>
                         </ul>`,
                    en: `<h2>2. Palpation${speakerIconH2}</h2>
                         <p>Includes both external abdominal palpation and rectal examination (fundamental in large animals).</p>
                         <ul>
                            <li><strong>External Abdominal Palpation:</strong> Performed with gradual pressure on the flanks and ventrally. Assess tenderness ("withers pinch test" in cattle), wall tension, presence of superficial masses.</li>
                            <li><strong>Rectal Examination:</strong> Crucial maneuver in cattle and horses. Allows assessment of:
                                <ul>
                                    <li><strong>Cattle:</strong> Rumen fill and stratification, position and consistency of reticulum, omasum, abomasum, intestinal loops, internal iliac lymph nodes, kidneys, bladder, genital tract.</li>
                                    <li><strong>Horse:</strong> Cecum, Large Colon (bands, sacculations), Small Colon (fecal balls), root of the mesentery, spleen, left and right kidney, bladder, internal inguinal ring (male), genital tract (female).</li>
                                </ul>
                             </li>
                         </ul>`
                },
                sectionPercussione: { 
                    it: `<h2>3. Percussione${speakerIconH2}</h2>
                         <p>Utilizzata principalmente per identificare la presenza e la localizzazione di gas, liquidi o masse nell'addome.</p>
                         <ul>
                             <li><strong>Percussione Generale:</strong> Eseguita sistematicamente su tutta l'area addominale. Si possono rilevare:
                                <ul>
                                    <li><strong>Suono Timpanico:</strong> Indica accumulo di gas (es. meteorismo ruminale, dislocazione abomasale sinistra nel bovino, timpanismo del cieco nel cavallo).</li>
                                    <li><strong>Suono Ottuso:</strong> Indica presenza di organi pieni, masse o liquidi (es. versamento peritoneale).</li>
                                </ul>
                             </li>
                            <li><strong>Percussione-Auscultazione (Tecnica del "Ping"):</strong> Fondamentale nel bovino per la diagnosi di Dislocazione dell'Abomaso (LDA/RDA). Consiste nel percuotere l'addome mentre si ausculta simultaneamente con il fonendoscopio; un suono metallico acuto ("ping") indica un organo cavo disteso da gas sotto pressione.</li>
                            <li><strong>Manovra di Succussione (o Ballottamento):</strong> Si applicano colpi rapidi al fianco con il pugno chiuso, percependo l'onda di ritorno del liquido con il palmo della mano appoggiato sulla parete addominale, per rilevare la presenza di liquido che "sciaborda" (es. idrope fetale, versamento).</li>
                            <li><strong>Percussione Area Epatica (Bovino):</strong> Eseguita a destra, caudalmente al limite polmonare posteriore (circa IX-XII spazio intercostale). Fisiologicamente si percepisce un'area di ottusità epatica di limitata estensione. Un suo aumento può indicare epatomegalia.</li>
                         </ul>`,
                    en: `<h2>3. Percussion${speakerIconH2}</h2>
                         <p>Mainly used to identify the presence and location of gas, fluid, or masses in the abdomen.</p>
                         <ul>
                            <li><strong>General Percussion:</strong> Performed systematically over the entire abdominal area. Can detect:
                                <ul>
                                    <li><strong>Tympanic Sound:</strong> Indicates gas accumulation (e.g., ruminal bloat, left displaced abomasum in cattle, cecal tympany in horses).</li>
                                    <li><strong>Dull Sound:</strong> Indicates the presence of solid organs, masses, or fluid (e.g., peritoneal effusion).</li>
                                </ul>
                             </li>
                            <li><strong>Auscultation-Percussion ("Ping" Technique):</strong> Fundamental in cattle for diagnosing Displaced Abomasum (LDA/RDA). It involves percussing the abdomen while simultaneously auscultating with a stethoscope; a high-pitched metallic sound ("ping") indicates a gas-distended hollow organ under pressure.</li>
                            <li><strong>Succussion (or Ballottement) Maneuver:</strong> Rapid thrusts are applied to the flank with a closed fist, perceiving the returning fluid wave with the palm resting on the abdominal wall, to detect the presence of sloshing fluid (e.g., hydrops fetalis, effusion).</li>
                             <li><strong>Hepatic Area Percussion (Cattle):</strong> Performed on the right side, caudal to the posterior lung limit (approx. IX-XII intercostal space). Physiologically, a limited area of hepatic dullness is perceived. An increase may indicate hepatomegaly.</li>
                         </ul>`
                },
                sectionAuscultazione: { 
                    it: `<h2>4. Auscultazione${speakerIconH2}</h2>
                         <p>Metodica fondamentale per valutare la motilità gastrointestinale.</p>
                         <ul>
                            <li><strong>Bovino:</strong> Si auscultano principalmente:
                                <ul>
                                    <li><strong>Rumine (Fossa del fianco Sx):</strong> Frequenza (1-2 contrazioni/2 min) e intensità delle contrazioni primarie.</li>
                                    <li><strong>Abomaso (Area ventrale Dx):</strong> Ricerca di suoni di "tintinnio" o gorgoglii in caso di dislocazione.</li>
                                     <li><strong>Intestino (Area Dx):</strong> Presenza e qualità dei borborigmi.</li>
                                </ul>
                            </li>
                            <li><strong>Cavallo (4 Quadranti):</strong>
                                <ul>
                                    <li><strong>Dorsale Sinistro:</strong> Borborigmi tenui e gorgoglianti (piccolo intestino).</li>
                                    <li><strong>Dorsale Destro:</strong> Suono prolungato di svuotamento del cieco ("sciacquone").</li>
                                     <li><strong>Ventrale Destro e Sinistro:</strong> Rumori intensi e prolungati di motilità del grosso colon ("treno").</li>
                                    <li><strong>Nota Bene:</strong> L'assenza di suoni (ileo paralitico) è un segno grave nel cavallo.</li>
                                </ul>
                            </li>
                         </ul>`,
                    en: `<h2>4. Auscultation${speakerIconH2}</h2>
                         <p>Fundamental method for assessing gastrointestinal motility.</p>
                         <ul>
                             <li><strong>Cattle:</strong> Primarily auscultate:
                                <ul>
                                    <li><strong>Rumen (Left paralumbar fossa):</strong> Frequency (1-2 contractions/2 min) and intensity of primary contractions.</li>
                                    <li><strong>Abomasum (Right ventral area):</strong> Listen for "tinkling" or gurgling sounds in case of displacement.</li>
                                     <li><strong>Intestine (Right area):</strong> Presence and quality of borborygmi.</li>
                                </ul>
                             </li>
                             <li><strong>Horse (4 Quadrants):</strong>
                                <ul>
                                    <li><strong>Left Dorsal:</strong> Faint, gurgling borborygmi (small intestine).</li>
                                    <li><strong>Right Dorsal:</strong> Prolonged cecal emptying sound ("flushing").</li>
                                     <li><strong>Right and Left Ventral:</strong> Intense and prolonged large colon motility sounds ("train").</li>
                                    <li><strong>Note:</strong> Absence of sounds (paralytic ileus) is a serious sign in the horse.</li>
                                </ul>
                            </li>
                         </ul>`
                },
                 sectionComplementari: { 
                    it: `<h2>5. Metodiche Complementari Semeiologiche${speakerIconH2}</h2>
                         <p>Manovre aggiuntive che integrano l'esame di base.</p>
                         <ul>
                            <li><strong>Sondaggio Oro-gastrico / Naso-gastrico:</strong> Essenziale nel cavallo con colica per decomprimere lo stomaco (valutare reflusso) e somministrare fluidi/farmaci. Utile anche nel bovino.</li>
                            <li><strong>Prove del Dolore Reticolare (Bovino):</strong> Come la "prova del garrese" o la "palpazione profonda xifoidea", mirano a evocare dolore in caso di reticoloperitonite traumatica.</li>
                            <li><strong>Esame del Liquido Ruminale (Bovino):</strong> Prelievo tramite sonda o ruminocentesi per valutare pH, colore, odore, attività protozoaria, test di riduzione del blu di metilene.</li>
                         </ul>`,
                    en: `<h2>5. Complementary Semeiotic Methods${speakerIconH2}</h2>
                         <p>Additional maneuvers that supplement the basic examination.</p>
                         <ul>
                            <li><strong>Oro-gastric / Naso-gastric Intubation:</strong> Essential in horses with colic to decompress the stomach (assess reflux) and administer fluids/medications. Also useful in cattle.</li>
                            <li><strong>Reticular Pain Tests (Cattle):</strong> Such as the "withers pinch test" or "deep xiphoid palpation," aim to elicit pain in case of traumatic reticuloperitonitis.</li>
                            <li><strong>Rumen Fluid Analysis (Cattle):</strong> Collection via tube or rumenocentesis to evaluate pH, color, odor, protozoal activity, methylene blue reduction test.</li>
                         </ul>`
                },

                btnPrint: { it: 'Stampa', en: 'Print' },
                footerText: { it: '&copy; 2024 Semeiotica Veterinaria. Creato da Sara Busechian.', en: '&copy; 2024 Veterinary Semeiotics. Created by Sara Busechian.' }
            };

            const accessibilityToggle = document.getElementById('accessibility-toggle');
            const langToggle = document.getElementById('lang-toggle');
            const body = document.body;
            let currentLanguage = localStorage.getItem('language') || 'it';
            const synth = window.speechSynthesis;
            let currentUtterance = null;
            let activeTTSButton = null;

            // Funzione di "riscaldamento" per il TTS
            function warmUpTTS() {
                if (synth.getVoices().length === 0) {
                    synth.onvoiceschanged = () => {
                        // console.log("Voci caricate");
                    };
                }
            }

            function speak(text, button) {
                if (synth.speaking && activeTTSButton === button) {
                    if (synth.paused) { 
                        synth.resume(); 
                        button.classList.add('playing'); 
                    } else { 
                        synth.pause(); 
                        button.classList.remove('playing'); 
                    }
                } else {
                    if (synth.speaking) { 
                        synth.cancel(); 
                    }
                    startSpeaking(text, button);
                }
            }

            function startSpeaking(text, button) {
                // Pulisce il testo da eventuali tag HTML residui
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = text;
                const cleanText = tempDiv.textContent || tempDiv.innerText || "";

                currentUtterance = new SpeechSynthesisUtterance(cleanText);
                currentUtterance.lang = currentLanguage === 'it' ? 'it-IT' : 'en-US';
                currentUtterance.onend = () => {
                    if (activeTTSButton) activeTTSButton.classList.remove('playing');
                    activeTTSButton = null;
                };
                currentUtterance.onerror = (event) => {
                    console.error('Errore SpeechSynthesis:', event.error);
                    if (activeTTSButton) activeTTSButton.classList.remove('playing');
                    activeTTSButton = null;
                };
                
                synth.speak(currentUtterance);
                
                if (activeTTSButton) activeTTSButton.classList.remove('playing');
                activeTTSButton = button;
                button.classList.add('playing');
            }

            function setupTTSListeners() {
                document.querySelectorAll('.tts-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const parent = e.currentTarget.parentNode;
                        const key = parent.dataset.langKey;
                        let textToRead = '';

                        if (key) {
                            // Per H1 e P (intro)
                            const htmlContent = translations[key][currentLanguage];
                            textToRead = htmlContent;
                        } else if (parent.tagName === 'H2') {
                            // Per H2 (legge l'intera sezione)
                            const sectionKey = parent.closest('[data-lang-key]').dataset.langKey;
                            if (translations[sectionKey]) {
                                textToRead = translations[sectionKey][currentLanguage];
                            }
                        }
                        
                        if (textToRead) {
                             // Rimuove l'icona del TTS dal testo da leggere
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = textToRead;
                            tempDiv.querySelectorAll('.tts-button').forEach(btn => btn.remove());
                            textToRead = tempDiv.innerHTML; // Usiamo innerHTML per preservare la struttura per la lettura
                            
                            speak(textToRead, e.currentTarget);
                        }
                    });
                });
            }

            const updateLanguage = (lang) => {
                document.documentElement.lang = lang;
                langToggle.textContent = lang === 'it' ? 'EN' : 'IT';
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[key] && translations[key][lang]) {
                         if (key === 'footerText') {
                             element.innerHTML = translations[key][lang];
                         } else {
                            element.innerHTML = translations[key][lang];
                         }
                    }
                });
                // Riconfigura i listener TTS dopo l'aggiornamento della lingua
                if (synth.speaking) synth.cancel();
                setupTTSListeners();
            };

            const setA11yMode = (enabled) => {
                if (enabled) { body.classList.add('dsa-mode'); localStorage.setItem('dsa-mode', 'enabled'); } 
                else { body.classList.remove('dsa-mode'); localStorage.setItem('dsa-mode', 'disabled'); }
            };

            langToggle.addEventListener('click', () => {
                currentLanguage = currentLanguage === 'it' ? 'en' : 'it';
                localStorage.setItem('language', currentLanguage);
                updateLanguage(currentLanguage);
            });

            accessibilityToggle.addEventListener('click', () => {
                const isEnabled = body.classList.contains('dsa-mode');
                setA11yMode(!isEnabled);
            });

            if (localStorage.getItem('dsa-mode') === 'enabled') {
                setA11yMode(true);
            }
            
            warmUpTTS(); // "Riscalda" il motore TTS al caricamento
            updateLanguage(currentLanguage); // Applica la lingua e imposta i listener
        });
    </script>
</body>
</html>

