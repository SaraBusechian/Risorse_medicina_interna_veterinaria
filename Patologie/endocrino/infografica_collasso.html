<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infografica - Gestione Ipocalcemia Bovina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fff1f2; color: #881337; }
        .content-section { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .nav-link { transition: all 0.2s; border-bottom: 2px solid transparent; padding-bottom: 4px; }
        .nav-link:hover, .nav-link.active { border-bottom-color: #f43f5e; color: #be185d; }
        .dsa-mode { font-family: 'Lexend', sans-serif; background: #fdf6f7 !important; color: #34495e; }
        .dsa-mode #main-header { background-color: #000000 !important; }
        .dsa-mode #main-header a, .dsa-mode #main-header button { color: #ffffff !important; }
        .dsa-mode .card { background: #fffdfd; border-top-color: #34495e; }
        .dsa-mode h1, .dsa-mode h2, .dsa-mode p, .dsa-mode li, .dsa-mode span, .dsa-mode div { color: #34495e !important; }
        .arrow-down { text-align: center; font-size: 2rem; color: #f9a8d4; margin-bottom: 1rem; }
        .decision-box { border: 2px solid #be185d; background-color: #fce7f3; padding: 1rem; border-radius: 0.5rem; font-weight: bold; text-align: center; margin-top: 1rem; }
        .result-positive { background-color: #d1fae5; border-color: #10b981; }
        .result-negative { background-color: #fee2e2; border-color: #ef4444; }
        .split-branch { display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; }
        .branch { flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 0.5rem; min-width: 250px; }
        /* Animazione pulsazione quando è in riproduzione */
        .playing svg { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="p-4 md:p-8">

    <header id="main-header" class="bg-rose-800 text-white shadow-md p-4 rounded-lg mb-8 flex justify-between items-center flex-wrap sticky top-0 z-50">
        <a href="bovina_collasso.html" class="inline-flex items-center font-bold hover:underline">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path></svg>
            <span data-lang-key="backToSummaryText">Torna al Riassunto</span>
        </a>
        <div class="flex items-center space-x-4">
            <button id="accessibility-toggle" aria-label="Attiva modalità ad alta leggibilità" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition" data-lang-key="accessibility">Accessibilità</button>
            <button id="lang-toggle" aria-label="Change language" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition">EN</button>
        </div>
    </header>

    <div class="container mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-rose-800" data-lang-key="pageTitle">Gestione del Collasso Puerperale (Milk Fever)</h1>
            <p class="text-lg text-rose-600" data-lang-key="pageSubtitle">Schema di trattamento d'emergenza e strategie di prevenzione (DCAD).</p>
            
        </header>

        <div class="max-w-4xl mx-auto">
            
            <!-- START: Emergenza -->
            <div class="card border-t-rose-500 text-center">
                <h2 data-lang-key="startTitle">EMERGENZA: IPOCALCEMIA CLINICA (Stadi II e III)</h2>
                <p data-lang-key="startDesc">Vacca in decubito sternale o laterale (prime 72h post-parto).</p>
            </div>

            <div class="arrow-down">↓</div>

            <!-- STEP 1: Trattamento IV -->
            <div class="card border-t-blue-500">
                <h2 class="text-blue-700" data-lang-key="step1Title">1. Trattamento IV Immediato</h2>
                <div class="decision-box bg-blue-100 border-blue-500" data-lang-key="treatmentIV">Calcio Borogluconato 23% (CBG) IV Lento (circa 500 mL)</div>
                <p class="text-sm text-center text-blue-700 mt-2" data-lang-key="monitoringNote">Monitoraggio obbligatorio: Frequenza cardiaca! Interrompere se bradicardia o aritmie.</p>
                
                <div class="split-branch">
                    <div class="branch p-3 bg-red-100 border-red-500">
                        <strong class="text-red-700" data-lang-key="responseNegative">NESSUNA RISPOSTA (Dopo 30 min)</strong>
                        <p class="text-sm text-red-800" data-lang-key="responseNegativeResult">Rivalutare altre cause di Paresi Puerperale (es. ipofosfatemia, danni nervosi) o ripetere Calcio IV con cautela.</p>
                    </div>
                    <div class="branch p-3 bg-green-100 border-green-500">
                        <strong class="text-green-700" data-lang-key="responsePositive">VACCA SI RIALZA (Dopo 30 min)</strong>
                        <p class="text-sm text-green-800" data-lang-key="responsePositiveResult">Successo IV. &rarr; Prosegui al Passo 2 (Calcio Orale).</p>
                    </div>
                </div>
            </div>

            <div class="arrow-down">↓</div>

            <!-- STEP 2: Trattamento di Supporto (Orale) -->
            <div class="card border-t-purple-500">
                <h2 class="text-purple-700" data-lang-key="step2Title">2. Terapia di Supporto e Prevenzione Ricadute</h2>
                <p class="mb-2" data-lang-key="oralCalciumDesc">Somministra Calcio per via orale e supporta il metabolismo:</p>
                <div class="decision-box bg-purple-100 border-purple-500" data-lang-key="oralTest">Calcio Orale (Gel o Paste) + Terapia di supporto</div>

                <ul class="list-check mt-3 text-purple-800 inline-block text-left">
                    <li data-lang-key="supportItem1">Calcio Orale (3-4 dosi) per sostenere il picco di lattazione.</li>
                    <li data-lang-key="supportItem2">Gestione delle lesioni da decubito e posizionamento corretto.</li>
                    <li data-lang-key="supportItem3">Trattare eventuali ipomagnesemia o ipofosfatemia coesistenti.</li>
                </ul>
            </div>

            <div class="arrow-down">↓</div>

            <!-- STEP 3: Prevenzione DCAD -->
            <div class="card border-t-green-500 text-center">
                <h2 class="text-green-700" data-lang-key="step3Title">3. Prevenzione di Stalla (DCAD)</h2>
                <p class="mt-2" data-lang-key="preventionGoal">Strategia chiave: Rendere la dieta **DCAD Negativa** nel pre-parto.</p>
                
                <div class="decision-box bg-green-100 border-green-500 mt-4" data-lang-key="dcadMethod">
                    Razioni Anioniche (Aggiunta di Sali Anionici)
                </div>
                
                <p class="text-sm mt-2" data-lang-key="dcadMonitoring">Monitoraggio del pH urinario (obiettivo: pH 6.0-6.5) per confermare l'efficacia della dieta e la mobilitazione del Calcio.</p>
            </div>
            
        </div>

        <footer class="text-center mt-16 pt-8 border-t border-rose-200 text-slate-500 text-sm">
            <p data-lang-key="footer-credit">A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria</p>
        </footer>
    </div>

    <script>
        // --- Dati e Traduzioni (Definiti in scope globale implicito) ---

        const translations = {
            backToSummaryText: { it: "Torna al Riassunto", en: "Back to Summary" },
            accessibility: { it: "Accessibilità", en: "Accessibility" },
            pageTitle: { it: "Gestione del Collasso Puerperale (Milk Fever)", en: "Periparturient Collapse (Milk Fever) Management" },
            pageSubtitle: { it: "Schema di trattamento d'emergenza e strategie di prevenzione (DCAD).", en: "Emergency treatment and prevention strategies flowchart (DCAD)." },

            startTitle: { it: "EMERGENZA: IPOCALCEMIA CLINICA (Stadi II e III)", en: "EMERGENCY: CLINICAL HYPOCALCEMIA (Stages II and III)" },
            startDesc: { it: "Vacca in decubito sternale o laterale (prime 72h post-parto).", en: "Cow in sternal or lateral recumbency (first 72h postpartum)." },

            step1Title: { it: "1. Trattamento IV Immediato", en: "1. Immediate IV Treatment" },
            treatmentIV: { it: "Calcio Borogluconato 23% (CBG) IV Lento (circa 500 mL)", en: "23% Calcium Borogluconate (CBG) Slow IV (approx. 500 mL)" },
            monitoringNote: { it: "Monitoraggio obbligatorio: Frequenza cardiaca! Interrompere se bradicardia o aritmie.", en: "Mandatory monitoring: Heart rate! Stop if bradycardia or arrhythmias occur." },
            responseNegative: { it: "NESSUNA RISPOSTA (Dopo 30 min)", en: "NO RESPONSE (After 30 min)" },
            responseNegativeResult: { it: "Rivalutare altre cause di Paresi Puerperale (es. ipofosfatemia, danni nervosi) o ripetere Calcio IV con cautela.", en: "Reassess other causes of Parturient Paresis (e.g., hypophosphatemia, nerve damage) or cautiously repeat IV Calcium." },
            responsePositive: { it: "VACCA SI RIALZA (Dopo 30 min)", en: "COW STANDS UP (After 30 min)" },
            responsePositiveResult: { it: "Successo IV. &rarr; Prosegui al Passo 2 (Calcio Orale).", en: "IV success. &rarr; Proceed to Step 2 (Oral Calcium)." },

            step2Title: { it: "2. Terapia di Supporto e Prevenzione Ricadute", en: "2. Support Therapy and Relapse Prevention" },
            oralCalciumDesc: { it: "Somministra Calcio per via orale e supporta il metabolismo:", en: "Administer oral Calcium and support metabolism:" },
            oralTest: { it: "Calcio Orale (Gel o Paste) + Terapia di supporto", en: "Oral Calcium (Gel or Paste) + Support Therapy" },
            supportItem1: { it: "Calcio Orale (3-4 dosi) per sostenere il picco di lattazione.", en: "Oral Calcium (3-4 doses) to support peak lactation." },
            supportItem2: { it: "Gestione delle lesioni da decubito e posizionamento corretto.", en: "Management of decubitus lesions and proper positioning." },
            supportItem3: { it: "Trattare eventuali ipomagnesemia o ipofosfatemia coesistenti.", en: "Treat any coexisting hypomagnesemia or hypophosphatemia." },

            step3Title: { it: "3. Prevenzione di Stalla (DCAD)", en: "3. Herd Prevention (DCAD)" },
            preventionGoal: { it: "Strategia chiave: Rendere la dieta **DCAD Negativa** nel pre-parto.", en: "Key strategy: Make the diet **Negative DCAD** pre-calving." },
            dcadMethod: { it: "Razioni Anioniche (Aggiunta di Sali Anionici)", en: "Anionic Rations (Addition of Anionic Salts)" },
            dcadMonitoring: { it: "Monitoraggio del pH urinario (obiettivo: pH 6.0-6.5) per confermare l'efficacia della dieta e la mobilitazione del Calcio.", en: "Monitor urinary pH (target: pH 6.0-6.5) to confirm diet effectiveness and Calcium mobilization." },

            "footer-credit": { it: "A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria", en: "Curated by Prof. Sara Busechian. Veterinary clinical medicine teachings" }
        };

        // --- Variabili Globali ---
        let currentLanguage = localStorage.getItem('language') || 'it';
        const synth = window.speechSynthesis;
        let activeTTSButton = null;
        let voicesLoaded = false;


        // --- Funzioni TTS (Rafforzate) ---
        function stopSpeech() { 
            if (synth.speaking || synth.paused) {
                synth.cancel(); 
            }
        }
        
        function speak(text, button) {
            if (!voicesLoaded) return;

            if (activeTTSButton === button) {
                if (synth.paused) { synth.resume(); button.classList.add('playing'); } 
                else if (synth.speaking) { synth.pause(); button.classList.remove('playing'); }
                return;
            }
            
            stopSpeech();
            if(activeTTSButton) activeTTSButton.classList.remove('playing');

            if (!text || text.length === 0) return;

            const u = new SpeechSynthesisUtterance(text);
            const langCode = currentLanguage === 'it' ? 'it-IT' : 'en-US';
            u.lang = langCode;
            
            const voice = synth.getVoices().find(v => v.lang.startsWith(langCode));
            if (voice) u.voice = voice;

            const cleanup = () => {
                button.classList.remove('playing');
                if (activeTTSButton === button) { activeTTSButton = null; }
            };

            u.onstart = () => { button.classList.add('playing'); activeTTSButton = button; };
            u.onend = u.onerror = cleanup;
            u.onpause = () => button.classList.remove('playing'); 
            u.onresume = () => button.classList.add('playing'); 
            
            synth.speak(u);
        }

        function setupTTS() {
             voicesLoaded = true;

            document.querySelectorAll('.tts-button').forEach(btn => {
                const parent = btn.parentNode;
                if (!parent) return;

                const newBtn = btn.cloneNode(true);
                parent.replaceChild(newBtn, btn);
                
                newBtn.addEventListener('click', (e) => {
                    e.stopPropagation();

                    let text = "";
                    const parentElement = newBtn.parentElement;
                    
                    if (parentElement.tagName === 'H1' || parentElement.tagName === 'H2') {
                        const clone = parentElement.cloneNode(true);
                        clone.querySelector('.tts-button')?.remove();
                        text = clone.textContent.trim();
                        // Aggiunge sottotitolo solo per H1
                        if (parentElement.tagName === 'H1') {
                            const subtitle = document.querySelector('[data-lang-key="pageSubtitle"]');
                            if (subtitle) text += '. ' + subtitle.textContent.trim();
                        }
                    }

                    if (text) speak(text, newBtn);
                });
            });
        }
        
        const initializeTTS = () => {
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = setupTTS;
                if (synth.getVoices().length > 0) {
                    setupTTS();
                }
            } else {
                setupTTS();
            }
        };


        // --- Funzioni di Controllo e Traduzione ---

        function loadQuiz(lang) {
             const c = document.getElementById('quiz-container'); 
             if(!c) return; 
             
             // Dati del quiz hardcoded qui per stabilità dell'infografica
             const quizData = { 'it': [], 'en': [] }; // In questa infografica il quiz è vuoto/omesso per focalizzazione sul flow
             const quizDataLang = quizData[lang] || [];
             
             c.innerHTML = '<p class="text-center italic text-slate-500">Il quiz è omesso in questo flowchart.</p>';
        }

        function updateLanguage(lang) {
            currentLanguage = lang; 
            document.documentElement.lang = lang;
            document.getElementById('lang-toggle').textContent = lang === 'it' ? 'EN' : 'IT';
            stopSpeech();
            
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.dataset.langKey;
                if(translations[key] && translations[key][lang]) {
                    if(key.includes('Content') || key.includes('Summary')) {
                        element.innerHTML = translations[key][lang];
                    }
                    else {
                        const tts = element.querySelector('.tts-button');
                        const newText = translations[key][lang];
                        const ttsHtml = tts ? tts.outerHTML : '';
                        
                        // Per i titoli, assicurati di non sovrascrivere l'icona TTS
                        if (key === 'pageTitle' || key === 'summaryTitle') {
                             const originalContent = element.innerHTML.replace(/<span class="tts-button".*?<\/svg><\/span>/, '');
                             if (originalContent.trim() !== newText.trim()) {
                                 element.innerHTML = newText + ttsHtml;
                             }
                        } else {
                            element.innerHTML = newText;
                        }
                    }
                }
            });
            
            const dsaToggle = document.getElementById('accessibility-toggle');
            const isDsaMode = document.body.classList.contains('dsa-mode');
            if (isDsaMode) {
                dsaToggle.textContent = lang === 'it' ? 'Vista Standard' : 'Standard View';
            } else {
                dsaToggle.textContent = lang === 'it' ? 'Accessibilità' : 'Accessibility';
            }
            
            loadQuiz(lang);
            if (voicesLoaded) setupTTS(); 
        }

        // --- Avvio Iniziale ---

        document.addEventListener('DOMContentLoaded', () => {
            initializeTTS();
            updateLanguage(currentLanguage);

            document.getElementById('lang-toggle').addEventListener('click', () => {
                const newLang = currentLanguage === 'it' ? 'en' : 'it';
                localStorage.setItem('language', newLang);
                stopSpeech();
                updateLanguage(newLang);
            });

            document.getElementById('accessibility-toggle').addEventListener('click', () => {
                document.body.classList.toggle('dsa-mode');
                updateLanguage(currentLanguage); 
            });

            document.getElementById('submit-quiz')?.addEventListener('click', ()=>{
                alert('Quiz non implementato in questo file infografica.');
            });

            document.getElementById('audio-play-pause')?.addEventListener('click', () => {
                alert('La riproduzione audio è un placeholder. Scarica il file MP3 per l\'ascolto.');
            });
        });
    </script>
</body>
</html>
