<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collasso Tracheale - Medicina Interna Veterinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0fdfa; color: #134e4a; }
        .content-section { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .nav-link { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .nav-link:hover, .nav-link.active { border-bottom-color: #0d9488; color: #0f766e; }
        .dsa-mode {
            font-family: 'Lexend', sans-serif;
            background-color: #fdfaf5 !important;
            letter-spacing: 0.05em;
            line-height: 1.75;
            color: #34495e;
        }
        .dsa-mode #main-header, .dsa-mode #main-footer { background-color: #000000 !important; }
        .dsa-mode #main-header h1, .dsa-mode #main-header a, .dsa-mode #main-footer p, .dsa-mode button { color: #ffffff !important; }
        .dsa-mode button { border: 1px solid #ffffff; }
        .dsa-mode .content-section { background-color: #fffdfa; border: 1px solid #e0e0e0; }
        .dsa-mode h1, .dsa-mode h2, .dsa-mode h3, .dsa-mode p, .dsa-mode li { color: #34495e; }
        .tts-button { cursor: pointer; display: inline-block; margin-left: 10px; vertical-align: middle; color: #64748b; transition: color 0.2s; }
        .tts-button:hover, .tts-button.playing { color: #0ea5e9; }
        .quiz-question { border: 1px solid #ccfbf1; transition: all 0.3s; }
        .quiz-option:hover { background-color: #f0fdfa; }
        .quiz-question.correct { background-color: #d1fae5; border-color: #10b981; }
        .quiz-question.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        @media print {
            #main-header, #main-footer, #page-nav, #infografica, #quiz, #audio, #print-button, .tts-button, video, img, a[href*="infografica"] { display: none; }
        }
    </style>
</head>
<body class="bg-teal-50">

    <header id="main-header" class="bg-teal-800 text-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center flex-wrap">
            <h1 class="text-xl font-bold !text-white !border-none !m-0 !p-0 !text-left" data-lang-key="siteTitle">Patologie Respiratorie</h1>
            <div class="flex items-center space-x-4">
                <button id="accessibility-toggle" aria-label="Attiva modalitÃ  ad alta leggibilitÃ " class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition" data-lang-key="accessibility">AccessibilitÃ </button>
                <button id="lang-toggle" aria-label="Change language" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition">EN</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-10">
        <div class="text-left mb-8">
            <a href="index.html" class="inline-flex items-center bg-white text-teal-700 font-bold py-2 px-4 rounded-lg shadow hover:bg-teal-100 transition duration-300" data-lang-key="backToIndex">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path></svg>
                <span data-lang-key="backToIndexText">Indice Patologie Respiratorie</span>
            </a>
        </div>
        
        <div class="content-section p-6 md:p-10">
            <header class="text-center border-b-2 border-teal-200 pb-6 mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-teal-800" data-lang-key="pageTitle">Collasso Tracheale</h1>
                <p class="text-lg text-teal-700 mt-2" data-lang-key="pageSubtitle">Gestione della patologia degenerativa della cartilagine tracheale.</p>
            </header>

            <nav id="page-nav" class="flex justify-center flex-wrap gap-4 md:gap-8 mb-10 border-b border-gray-200">
                <a href="#riassunto" class="nav-link font-semibold py-2" data-lang-key="navSummary">Riassunto</a>
                <a href="#infografica" class="nav-link font-semibold py-2" data-lang-key="navInfographic">Infografica</a>
                <a href="#quiz" class="nav-link font-semibold py-2" data-lang-key="navQuiz">Quiz</a>
                <a href="#audio" class="nav-link font-semibold py-2" data-lang-key="navAudio">Audio</a>
                <a href="#bibliografia" class="nav-link font-semibold py-2" data-lang-key="navBibliography">Bibliografia</a>
            </nav>

            <article class="space-y-12">
                <section id="riassunto">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4 flex items-center" data-lang-key="summaryTitle">Riassunto Completo <span class="tts-button"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h2>
                    <div class="prose max-w-none text-teal-900" data-lang-key="summaryContent">
                        <!-- Content loaded by JS -->
                    </div>
                </section>

                <section id="infografica">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="infographicTitle">Infografica Riepilogativa</h2>
                     <a href="infografica_collasso_tracheale.html" target="_blank" class="block bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow border-l-4 border-teal-500">
                        <div class="flex items-center space-x-6">
                            <div class="flex-shrink-0 w-24 h-24 bg-teal-500 rounded-lg flex items-center justify-center">
                                <span class="text-5xl" role="img" aria-label="Icona di un cane di piccola taglia">ðŸ¦´</span>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-teal-800" data-lang-key="infographicLinkTitle">Visualizza l'Infografica Dettagliata</h3>
                                <p class="text-gray-600 mt-1" data-lang-key="infographicLinkDesc">Clicca qui per una guida visuale completa sul collasso tracheale.</p>
                            </div>
                        </div>
                    </a>
                </section>

                <section id="quiz">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="quizTitle">Quiz di Autovalutazione</h2>
                    <div id="quiz-container" class="space-y-6">
                        <!-- Questions loaded by JS -->
                    </div>
                    <div class="mt-6 text-center">
                        <button id="submit-quiz" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition" data-lang-key="quizSubmit">Verifica Risposte</button>
                    </div>
                    <div id="quiz-results" class="mt-6 text-center text-xl font-bold"></div>
                </section>

                <section id="audio">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="audioTitle">Ascolta il Riassunto</h2>
                    <div class="p-4 bg-teal-100/50 rounded-lg flex flex-col sm:flex-row items-center gap-4 w-full">
                        <button id="audio-play-pause" class="p-3 bg-teal-500 text-white rounded-full hover:bg-teal-600 transition-colors duration-200">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.27l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                            </svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M5.75 4.5a.75.75 0 00-.75.75v10a.75.75 0 001.5 0v-10a.75.75 0 00-.75-.75zM14.25 4.5a.75.75 0 00-.75.75v10a.75.75 0 001.5 0v-10a.75.75 0 00-.75-.75z" />
                            </svg>
                        </button>
                        <div class="flex-grow text-center sm:text-left">
                            <p class="font-semibold text-teal-800" data-lang-key="audioListen">Ascolta il riassunto completo</p>
                            <p class="text-sm text-teal-600" data-lang-key="audioDesc">Ideale per ripassare mentre sei in movimento.</p>
                        </div>
                        <a href="audio_collasso_tracheale.mp3" download class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition inline-flex items-center w-full sm:w-auto justify-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            <span data-lang-key="btnDownloadAudio">Scarica</span>
                        </a>
                    </div>
                </section>

                <section id="bibliografia">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="bibliographyTitle">Riferimenti Bibliografici</h2>
                    <ul class="list-disc pl-6 text-teal-900" data-lang-key="bibliographyContent">
                        <!-- Content loaded by JS -->
                    </ul>
                </section>
            </article>
            
            <div class="mt-12 text-center">
                <button id="print-button" onclick="window.print()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition inline-flex items-center" data-lang-key="btnPrint">Stampa Riassunto</button>
            </div>
        </div>
    </main>
    <footer id="main-footer" class="text-center mt-16 pt-8 border-t border-slate-200">
        <p class="text-slate-500" data-lang-key="footer-credit">A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria</p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                siteTitle: { it: "Patologie Respiratorie", en: "Respiratory Diseases" },
                backToIndexText: { it: "Indice Patologie Respiratorie", en: "Respiratory Pathology Index" },
                pageTitle: { it: "Collasso Tracheale", en: "Tracheal Collapse" },
                pageSubtitle: { it: "Gestione della patologia degenerativa della cartilagine tracheale.", en: "Management of degenerative tracheal cartilage disease." },
                navSummary: { it: "Riassunto", en: "Summary" },
                navInfographic: { it: "Infografica", en: "Infographic" },
                navQuiz: { it: "Quiz", en: "Quiz" },
                navAudio: { it: "Audio", en: "Audio" },
                navBibliography: { it: "Bibliografia", en: "Bibliography" },
                summaryTitle: { it: "Riassunto Completo", en: "Full Summary" },
                summaryContent: { 
                    it: `<p>Il <strong>collasso tracheale</strong> Ã¨ una patologia cronica, progressiva e irreversibile che colpisce prevalentemente cani di piccola taglia (es. Yorkshire Terrier, Pomerania, Chihuahua, Barbone nano). Ãˆ caratterizzata da una degenerazione della cartilagine degli anelli tracheali (condromalacia), che perdono la loro rigiditÃ  e si appiattiscono in senso dorso-ventrale.</p>
                         <div class="mt-4 p-4 bg-teal-50 rounded-lg border border-teal-200"><p>Questa patologia si differenzia da altre cause di tosse e dispnea. <a href="confronto_vie_aeree_cane.html" class="text-teal-600 hover:underline font-semibold">Clicca qui per un confronto dettagliato.</a></p></div>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Fisiopatologia</h3>
                         <p>Il collasso puÃ² interessare diverse porzioni della trachea:</p>
                         <ul>
                            <li><strong>Tratto Cervicale:</strong> La trachea collassa durante l'<strong>inspirazione</strong> a causa della pressione negativa extraluminale.</li>
                            <li><strong>Tratto Intratoracico:</strong> La trachea collassa durante l'<strong>espirazione</strong> a causa della pressione positiva extraluminale.</li>
                         </ul>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Segni Clinici</h3>
                         <p>Il segno clinico predominante Ã¨ una tosse cronica e caratteristica:</p>
                         <ul class="list-disc pl-5 space-y-1 mt-2">
                            <li><strong>Tosse cronica, secca, a "verso d'oca" (goose honk).</strong></li>
                            <li>La tosse Ã¨ facilmente scatenata da eccitazione, esercizio, tirare al guinzaglio o bere.</li>
                            <li>Dispnea e stridore inspiratorio (se il collasso Ã¨ cervicale) o sibili espiratori (se il collasso Ã¨ intratoracico).</li>
                            <li>Nei casi gravi, si possono avere cianosi e sincopi.</li>
                         </ul>
                         <div class="my-4 p-4 border rounded-lg bg-gray-50"><p class="text-sm font-semibold text-gray-700 mb-2">Radiografia di Collasso Tracheale</p><img src="collasso_tracheale_rx.jpg" alt="Radiografia di un cane con collasso tracheale" class="w-full max-w-md mx-auto rounded-lg shadow-md"><p class="text-center text-xs text-gray-500 mt-1">Restringimento del lume tracheale a livello del tratto cervicale.</p></div>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Diagnosi</h3>
                         <ul>
                            <li><strong>Radiografie Toraciche e Cervicali:</strong> Vanno eseguite sia in fase inspiratoria che espiratoria per massimizzare la possibilitÃ  di evidenziare il collasso.</li>
                            <li><strong>Fluoroscopia:</strong> Permette una valutazione dinamica del diametro tracheale durante l'intero ciclo respiratorio.</li>
                            <li><strong>Endoscopia:</strong> Ãˆ il <strong>gold standard</strong>. Permette la visualizzazione diretta e la classificazione del collasso in 4 gradi, a seconda della riduzione del lume.</li>
                         </ul>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Terapia</h3>
                         <p>L'approccio terapeutico varia in base alla gravitÃ  del collasso (Grado I-IV).</p>
                         <ul>
                            <li><strong>Terapia Medica (per Gradi I-II e gestione cronica):</strong>
                                <ul class="list-disc pl-5 mt-2">
                                    <li>Controllo del peso corporeo (l'obesitÃ  Ã¨ un fattore aggravante).</li>
                                    <li>Uso della pettorina al posto del collare.</li>
                                    <li>Controllo dell'ambiente per evitare eccitazione e irritanti.</li>
                                    <li><strong>Farmaci:</strong> Antitussigeni (Butorfanolo, Idrocodone), Corticosteroidi (cicli brevi per l'infiammazione), Broncodilatatori.</li>
                                </ul>
                            </li>
                            <li><strong>Terapia Chirurgica/Interventistica (per Gradi III-IV refrattari alla terapia medica):</strong>
                                <ul class="list-disc pl-5 mt-2">
                                    <li><strong>Anelli Protesici Extraluminali:</strong> Per il collasso cervicale.</li>
                                    <li><strong>Stent Intraluminale:</strong> Per il collasso intratoracico o in casi estesi.</li>
                                </ul>
                            </li>
                         </ul>`,
                    en: `<p><strong>Tracheal collapse</strong> is a chronic, progressive, and irreversible disease that predominantly affects small breed dogs (e.g., Yorkshire Terrier, Pomeranian, Chihuahua, Toy Poodle). It is characterized by a dorsoventral flattening of the tracheal rings due to cartilage degeneration (chondromalacia), causing them to lose their rigidity.</p>
                         <div class="mt-4 p-4 bg-teal-50 rounded-lg border border-teal-200"><p>This condition differs from other causes of cough and dyspnea. <a href="confronto_vie_aeree_cane.html" class="text-teal-600 hover:underline font-semibold">Click here for a detailed comparison.</a></p></div>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Pathophysiology</h3>
                         <p>The collapse can affect different portions of the trachea:</p>
                         <ul>
                            <li><strong>Cervical Portion:</strong> The trachea collapses during <strong>inspiration</strong> due to negative extraluminal pressure.</li>
                            <li><strong>Intrathoracic Portion:</strong> The trachea collapses during <strong>expiration</strong> due to positive extraluminal pressure.</li>
                         </ul>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Clinical Signs</h3>
                         <p>The predominant clinical sign is a characteristic chronic cough:</p>
                         <ul class="list-disc pl-5 space-y-1 mt-2">
                            <li><strong>Chronic, dry, "goose honk" cough.</strong></li>
                            <li>The cough is easily triggered by excitement, exercise, leash pulling, or drinking.</li>
                            <li>Dyspnea and inspiratory stridor (if cervical collapse) or expiratory wheezes (if intrathoracic collapse).</li>
                            <li>In severe cases, cyanosis and syncope may occur.</li>
                         </ul>
                         <div class="my-4 p-4 border rounded-lg bg-gray-50"><p class="text-sm font-semibold text-gray-700 mb-2">Radiograph of Tracheal Collapse</p><img src="collasso_tracheale_rx.jpg" alt="Radiograph of a dog with tracheal collapse" class="w-full max-w-md mx-auto rounded-lg shadow-md"><p class="text-center text-xs text-gray-500 mt-1">Narrowing of the tracheal lumen in the cervical region.</p></div>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Diagnosis</h3>
                         <ul>
                            <li><strong>Cervical and Thoracic Radiographs:</strong> Should be taken during both inspiration and expiration to maximize the chance of visualizing the collapse.</li>
                            <li><strong>Fluoroscopy:</strong> Allows for a dynamic evaluation of the tracheal diameter throughout the respiratory cycle.</li>
                            <li><strong>Endoscopy:</strong> It is the <strong>gold standard</strong>. It allows direct visualization and grading of the collapse into 4 grades, depending on the lumen reduction.</li>
                         </ul>
                         <h3 class="text-2xl font-semibold mt-6 mb-3">Therapy</h3>
                         <p>The therapeutic approach varies based on the severity of the collapse (Grade I-IV).</p>
                         <ul>
                            <li><strong>Medical Therapy (for Grades I-II and chronic management):</strong>
                                <ul class="list-disc pl-5 mt-2">
                                    <li>Weight management (obesity is an aggravating factor).</li>
                                    <li>Use of a harness instead of a collar.</li>
                                    <li>Environmental control to avoid excitement and irritants.</li>
                                    <li><strong>Drugs:</strong> Antitussives (Butorphanol, Hydrocodone), Corticosteroids (short courses for inflammation), Bronchodilators.</li>
                                </ul>
                            </li>
                            <li><strong>Surgical/Interventional Therapy (for Grades III-IV refractory to medical therapy):</strong>
                                <ul class="list-disc pl-5 mt-2">
                                    <li><strong>Extraluminal Prosthetic Rings:</strong> For cervical collapse.</li>
                                    <li><strong>Intraluminal Stent:</strong> For intrathoracic or extensive collapse.</li>
                                </ul>
                            </li>
                         </ul>`
                },
                infographicTitle: { it: "Infografica Riepilogativa", en: "Summary Infographic" },
                infographicLinkTitle: { it: "Visualizza l'Infografica Dettagliata", en: "View the Detailed Infographic" },
                infographicLinkDesc: { it: "Clicca qui per una guida visuale completa sul collasso tracheale.", en: "Click here for a complete visual guide on tracheal collapse." },
                quizTitle: { it: "Quiz di Autovalutazione", en: "Self-Assessment Quiz" },
                quizSubmit: { it: "Verifica Risposte", en: "Check Answers" },
                audioTitle: { it: "Ascolta il Riassunto", en: "Listen to the Summary" },
                btnDownloadAudio: { it: "Scarica", en: "Download" },
                audioListen: { it: "Ascolta il riassunto completo", en: "Listen to the full summary" },
                audioDesc: { it: "Ideale per ripassare mentre sei in movimento.", en: "Ideal for reviewing on the go." },
                bibliographyTitle: { it: "Riferimenti Bibliografici", en: "Bibliographical References" },
                bibliographyContent: { 
                    it: `<li>CotÃ© E, Ettinger SJ, Feldman EC, ETTINGER'S TEXTBOOK OF VETERINARY INTERNAL MEDICINE, 9Â° ed., Elsevier, 2024</li>`,
                    en: `<li>CotÃ© E, Ettinger SJ, Feldman EC, ETTINGER'S TEXTBOOK OF VETERINARY INTERNAL MEDICINE, 9th ed., Elsevier, 2024</li>` 
                },
                btnPrint: { it: "Stampa Riassunto", en: "Print Summary" },
                accessibility: { it: "AccessibilitÃ ", en: "Accessibility" },
                "footer-credit": { it: "A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria", en: "Curated by Prof. Sara Busechian. Veterinary clinical medicine teachings" }
            };

            const quizData = {
                it: [
                    { question: "Qual Ã¨ la causa principale del collasso tracheale?", options: ["Infezione batterica", "Degenerazione della cartilagine", "Reazione allergica", "Trauma"], answer: "Degenerazione della cartilagine" },
                    { question: "Quale tipo di cane Ã¨ piÃ¹ predisposto al collasso tracheale?", options: ["Cani di taglia grande", "Cani di piccola taglia", "Cani brachicefali", "Cani anziani di qualsiasi taglia"], answer: "Cani di piccola taglia" },
                    { question: "La tosse a 'verso d'oca' Ã¨ un segno tipico di quale patologia?", options: ["Bronchite cronica", "Asma felina", "Collasso tracheale", "Polmonite interstiziale"], answer: "Collasso tracheale" },
                    { question: "Il collasso della porzione cervicale della trachea avviene durante:", options: ["L'inspirazione", "L'espirazione", "Entrambe le fasi", "Solo a riposo"], answer: "L'inspirazione" },
                    { question: "Qual Ã¨ il 'gold standard' per la diagnosi e la stadiazione del collasso tracheale?", options: ["Radiografia", "Ecografia", "Fluoroscopia", "Endoscopia"], answer: "Endoscopia" },
                    { question: "Quale di queste misure NON fa parte della gestione conservativa?", options: ["Controllo del peso", "Uso della pettorina", "Posizionamento di uno stent", "Evitare irritanti ambientali"], answer: "Posizionamento di uno stent" },
                    { question: "Quale farmaco si usa per controllare la componente infiammatoria della tosse?", options: ["Antitussigeni", "Broncodilatatori", "Corticosteroidi", "Antibiotici"], answer: "Corticosteroidi" },
                    { question: "La chirurgia (anelli o stent) Ã¨ generalmente riservata a quale grado di collasso?", options: ["Solo Grado I", "Grado I e II", "Gradi III e IV", "Non Ã¨ mai indicata"], answer: "Gradi III e IV" },
                    { question: "Il collasso della porzione intratoracica della trachea peggiora durante:", options: ["L'inspirazione", "L'espirazione", "La deglutizione", "Il sonno"], answer: "L'espirazione" },
                    { question: "Cosa si intende per 'condromalacia'?", options: ["Infiammazione della trachea", "Infezione della cartilagine", "Indebolimento/degenerazione della cartilagine", "Frattura della cartilagine"], answer: "Indebolimento/degenerazione della cartilagine" }
                ],
                en: [
                    { question: "What is the main cause of tracheal collapse?", options: ["Bacterial infection", "Cartilage degeneration", "Allergic reaction", "Trauma"], answer: "Cartilage degeneration" },
                    { question: "Which type of dog is most predisposed to tracheal collapse?", options: ["Large breed dogs", "Small breed dogs", "Brachycephalic dogs", "Senior dogs of any size"], answer: "Small breed dogs" },
                    { question: "The 'goose honk' cough is a typical sign of which condition?", options: ["Chronic bronchitis", "Feline asthma", "Tracheal collapse", "Interstitial pneumonia"], answer: "Tracheal collapse" },
                    { question: "Collapse of the cervical portion of the trachea occurs during:", options: ["Inspiration", "Expiration", "Both phases", "Only at rest"], answer: "Inspiration" },
                    { question: "What is the 'gold standard' for diagnosing and grading tracheal collapse?", options: ["Radiography", "Ultrasound", "Fluoroscopy", "Endoscopy"], answer: "Endoscopy" },
                    { question: "Which of these measures is NOT part of conservative management?", options: ["Weight control", "Use of a harness", "Stent placement", "Avoiding environmental irritants"], answer: "Stent placement" },
                    { question: "Which drug is used to control the inflammatory component of the cough?", options: ["Antitussives", "Bronchodilators", "Corticosteroids", "Antibiotics"], answer: "Corticosteroids" },
                    { question: "Surgery (rings or stent) is generally reserved for which grades of collapse?", options: ["Grade I only", "Grades I and II", "Grades III and IV", "It is never indicated"], answer: "Grades III and IV" },
                    { question: "Collapse of the intrathoracic portion of the trachea worsens during:", options: ["Inspiration", "Expiration", "Swallowing", "Sleep"], answer: "Expiration" },
                    { question: "What is meant by 'chondromalacia'?", options: ["Inflammation of the trachea", "Infection of the cartilage", "Weakening/degeneration of the cartilage", "Fracture of the cartilage"], answer: "Weakening/degeneration of the cartilage" }
                ]
            };
            
            let currentLanguage = localStorage.getItem('language') || 'it';
            
            const synth = window.speechSynthesis;
            let currentUtterance = null;
            let activeTTSButton = null;

            function speak(text, button) {
                if (activeTTSButton === button && currentUtterance) {
                    if (synth.paused) {
                        synth.resume();
                    } else if (synth.speaking) {
                        synth.pause();
                    }
                    return; 
                }

                if (synth.speaking || synth.paused) {
                    synth.cancel();
                }
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = currentLanguage === 'it' ? 'it-IT' : 'en-US';
                
                currentUtterance.onstart = () => {
                    if(activeTTSButton) activeTTSButton.classList.remove('playing');
                    button.classList.add('playing');
                    activeTTSButton = button;
                };

                currentUtterance.onpause = () => {
                    button.classList.remove('playing');
                };

                currentUtterance.onresume = () => {
                    button.classList.add('playing');
                };
                
                const cleanup = () => {
                    button.classList.remove('playing');
                    if(activeTTSButton === button) {
                        activeTTSButton = null;
                        currentUtterance = null;
                    }
                };

                currentUtterance.onend = cleanup;

                currentUtterance.onerror = (event) => {
                    if (event.error !== 'canceled') {
                       console.error('An error occurred with speech synthesis:', event.error);
                    }
                    cleanup();
                };

                synth.speak(currentUtterance);
            }


            let sound = null;

            function initHowler() {
                sound = new Howl({
                    src: ['audio_collasso_tracheale.mp3'],
                    html5: true, 
                    onplay: () => { playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden'); },
                    onpause: () => { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); },
                    onend: () => { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); },
                    onloaderror: (id, msg) => {
                        console.error("Error loading audio:", msg);
                        const audioDesc = document.querySelector('[data-lang-key="audioDesc"]');
                        if (audioDesc) audioDesc.textContent = "Errore nel caricamento del file audio.";
                    },
                    onplayerror: (id, msg) => {
                        console.error("Error playing audio:", msg);
                        const audioDesc = document.querySelector('[data-lang-key="audioDesc"]');
                        if (audioDesc) audioDesc.textContent = "Impossibile riprodurre il file audio.";
                    }
                });
            }

            const playPauseBtn = document.getElementById('audio-play-pause');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');

            playPauseBtn.addEventListener('click', () => {
                if (!sound) initHowler();
                if (sound.playing()) sound.pause(); else sound.play();
            });

            function setupTTSListeners() {
                document.querySelectorAll('.tts-button').forEach(button => {
                    const newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                    newButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        let textToRead = '';
                        const parentElement = newButton.parentElement;
                        if (parentElement.tagName === 'H2') {
                            const section = parentElement.closest('section');
                            let contentToRead = '';
                            if(section){
                                const clone = section.cloneNode(true);
                                clone.querySelectorAll('h2, button, a, img, audio, .tts-button, #quiz, #infografica, #audio, #bibliografia').forEach(el => el.remove());
                                contentToRead = clone.textContent.trim().replace(/\s\s+/g, ' ');
                            }
                            const titleClone = parentElement.cloneNode(true);
                            titleClone.querySelector('.tts-button').remove();
                            textToRead = `${titleClone.textContent.trim()}. ${contentToRead}`;
                        } 
                        else if (parentElement.tagName === 'H3') {
                               const questionTextNode = parentElement.querySelector('span:first-child');
                               if (questionTextNode) textToRead = questionTextNode.textContent.trim().replace(/^\d+\.\s*/, '');
                        }
                        else if (parentElement.closest('label')) {
                            const label = parentElement.closest('label');
                            const answerTextNode = label.querySelector('span:first-child');
                            if (answerTextNode) textToRead = answerTextNode.textContent.trim();
                        }
                        if (textToRead) speak(textToRead, newButton);
                    });
                });
            }

            function loadQuiz(lang) {
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.innerHTML = '';
                document.getElementById('quiz-results').innerHTML = ''; 
                quizData[lang].forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'quiz-question p-4 rounded-lg';
                    let optionsHtml = q.options.map(o => `
                        <li class="quiz-option p-2 rounded hover:bg-teal-50">
                            <label class="flex items-center justify-between w-full cursor-pointer">
                                <span class="flex-grow pr-4"><input type="radio" name="q${index}" value="${o}" class="mr-3">${o}</span>
                                <span class="tts-button flex-shrink-0"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span>
                            </label>
                        </li>`).join('');
                    questionDiv.innerHTML = `<h3 class="font-semibold mb-2 flex items-center justify-between"><span>${index + 1}. ${q.question}</span><span class="tts-button"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h3><ul class="space-y-1">${optionsHtml}</ul>`;
                    quizContainer.appendChild(questionDiv);
                });
            }

            function updateLanguage(lang) {
                document.documentElement.lang = lang;
                document.getElementById('lang-toggle').textContent = lang === 'it' ? 'EN' : 'IT';
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[key] && translations[key][lang]) {
                        if (key.includes('Content')) {
                                element.innerHTML = translations[key][lang];
                        } else {
                            const ttsButton = element.querySelector('.tts-button');
                            element.textContent = translations[key][lang];
                            if(ttsButton) element.appendChild(ttsButton);
                        }
                    }
                });
                
                const navAudio = document.querySelector('a[data-lang-key="navAudio"]');
                const sectionAudio = document.getElementById('audio');
                if (lang === 'en') {
                    if(navAudio) navAudio.style.display = 'none';
                    if(sectionAudio) sectionAudio.style.display = 'none';
                } else {
                    if(navAudio) navAudio.style.display = 'block';
                    if(sectionAudio) sectionAudio.style.display = 'block';
                }

                const dsaToggle = document.getElementById('accessibility-toggle');
                if (document.body.classList.contains('dsa-mode')) {
                    dsaToggle.textContent = lang === 'it' ? 'Vista Standard' : 'Standard View';
                } else {
                    dsaToggle.textContent = lang === 'it' ? 'AccessibilitÃ ' : 'Accessibility';
                }
                loadQuiz(lang);
                setupTTSListeners();
            }
            
            document.getElementById('lang-toggle').addEventListener('click', () => {
                currentLanguage = currentLanguage === 'it' ? 'en' : 'it';
                localStorage.setItem('language', currentLanguage);
                updateLanguage(currentLanguage);
            });

            const dsaToggle = document.getElementById('accessibility-toggle');
            dsaToggle.addEventListener('click', () => {
                document.body.classList.toggle('dsa-mode');
                 if (document.body.classList.contains('dsa-mode')) {
                    dsaToggle.textContent = currentLanguage === 'it' ? 'Vista Standard' : 'Standard View';
                } else {
                    dsaToggle.textContent = currentLanguage === 'it' ? 'AccessibilitÃ ' : 'Accessibility';
                }
            });

            document.getElementById('submit-quiz').addEventListener('click', () => {
                let score = 0;
                const questions = document.querySelectorAll('.quiz-question');
                quizData[currentLanguage].forEach((q, index) => {
                    const selected = document.querySelector(`input[name="q${index}"]:checked`);
                    questions[index].classList.remove('correct', 'incorrect');
                    if (selected) {
                        if (selected.value === q.answer) {
                            score++;
                            questions[index].classList.add('correct');
                        } else {
                            questions[index].classList.add('incorrect');
                        }
                    } else {
                        questions[index].classList.add('incorrect');
                    }
                });
                const resultsContainer = document.getElementById('quiz-results');
                const resultText = {
                    it: `Hai risposto correttamente a ${score} su ${quizData.it.length} domande.`,
                    en: `You answered ${score} out of ${quizData.en.length} questions correctly.`
                };
                resultsContainer.textContent = resultText[currentLanguage];
            });
            
            // Initial setup
            updateLanguage(currentLanguage);
        });
    </script>
</body>
</html>
