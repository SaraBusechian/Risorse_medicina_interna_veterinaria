<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinusiti nel Cavallo - Medicina Interna Veterinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0fdfa; color: #134e4a; }
        .content-section { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .nav-link { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .nav-link:hover, .nav-link.active { border-bottom-color: #0d9488; color: #0f766e; }
        .dsa-mode {
            font-family: 'Lexend', sans-serif;
            background-color: #fdfaf5 !important;
            letter-spacing: 0.05em;
            line-height: 1.75;
            color: #34495e;
        }
        .dsa-mode #main-header, .dsa-mode #main-footer { background-color: #000000 !important; }
        .dsa-mode #main-header h1, .dsa-mode #main-header a, .dsa-mode #main-footer p, .dsa-mode button { color: #ffffff !important; }
        .dsa-mode button { border: 1px solid #ffffff; }
        .dsa-mode .content-section { background-color: #fffdfa; border: 1px solid #e0e0e0; }
        .dsa-mode h1, .dsa-mode h2, .dsa-mode h3, .dsa-mode p, .dsa-mode li { color: #34495e; }
        .tts-button { cursor: pointer; display: inline-block; margin-left: 10px; vertical-align: middle; color: #64748b; transition: color 0.2s; }
        .tts-button:hover, .tts-button.playing { color: #0ea5e9; }
        .quiz-question { border: 1px solid #ccfbf1; transition: all 0.3s; }
        .quiz-option:hover { background-color: #f0fdfa; }
        .quiz-question.correct { background-color: #d1fae5; border-color: #10b981; }
        .quiz-question.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        @media print {
            #main-header, #main-footer, #page-nav, #infografica, #quiz, #audio, #print-button, .tts-button, video, img, a[href*="infografica"] { display: none; }
        }
    </style>
</head>
<body class="bg-teal-50">

    <header id="main-header" class="bg-teal-800 text-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center flex-wrap">
            <h1 class="text-xl font-bold !text-white !border-none !m-0 !p-0 !text-left" data-lang-key="siteTitle">Patologie Respiratorie</h1>
            <div class="flex items-center space-x-4">
                <button id="accessibility-toggle" aria-label="Attiva modalità ad alta leggibilità" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition" data-lang-key="accessibility">Accessibilità</button>
                <button id="lang-toggle" aria-label="Change language" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition">EN</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-10">
        <div class="text-left mb-8">
            <a href="index.html" class="inline-flex items-center bg-white text-teal-700 font-bold py-2 px-4 rounded-lg shadow hover:bg-teal-100 transition duration-300" data-lang-key="backToIndex">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path></svg>
                <span data-lang-key="backToIndexText">Indice Patologie Respiratorie</span>
            </a>
        </div>
        
        <div class="content-section p-6 md:p-10">
            <header class="text-center border-b-2 border-teal-200 pb-6 mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-teal-800" data-lang-key="pageTitle">Sinusiti nel Cavallo</h1>
                <p class="text-lg text-teal-700 mt-2" data-lang-key="pageSubtitle">Approccio diagnostico e terapeutico all'infiammazione dei seni paranasali.</p>
            </header>

            <nav id="page-nav" class="flex justify-center flex-wrap gap-4 md:gap-8 mb-10 border-b border-gray-200">
                <a href="#riassunto" class="nav-link font-semibold py-2" data-lang-key="navSummary">Riassunto</a>
                <a href="#infografica" class="nav-link font-semibold py-2" data-lang-key="navInfographic">Infografica</a>
                <a href="#quiz" class="nav-link font-semibold py-2" data-lang-key="navQuiz">Quiz</a>
                <a href="#audio" class="nav-link font-semibold py-2" data-lang-key="navAudio">Audio</a>
                <a href="#bibliografia" class="nav-link font-semibold py-2" data-lang-key="navBibliography">Bibliografia</a>
            </nav>

            <article class="space-y-12">
                <section id="riassunto">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4 flex items-center" data-lang-key="summaryTitle">Riassunto Completo <span class="tts-button"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h2>
                    <div class="prose max-w-none text-teal-900" data-lang-key="summaryContent">
                        <!-- Content loaded by JS -->
                    </div>
                </section>

                <section id="infografica">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="infographicTitle">Infografica Riepilogativa</h2>
                    <div class="bg-gray-100 p-4 rounded-lg flex justify-center items-center">
                        <a href="infografica_sinusiti_cavallo.html" target="_blank" class="block hover:opacity-90 transition-opacity">
                            <img src="https://placehold.co/800x600/0d9488/ffffff?text=Clicca+per+visualizzare+l'infografica" alt="Anteprima infografica sulla sinusite equina" class="max-w-full h-auto rounded-md shadow-md">
                        </a>
                    </div>
                </section>

                <section id="quiz">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="quizTitle">Quiz di Autovalutazione</h2>
                    <div id="quiz-container" class="space-y-6">
                        <!-- Questions loaded by JS -->
                    </div>
                    <div class="mt-6 text-center">
                        <button id="submit-quiz" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition" data-lang-key="quizSubmit">Verifica Risposte</button>
                    </div>
                    <div id="quiz-results" class="mt-6 text-center text-xl font-bold"></div>
                </section>

                <section id="audio">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="audioTitle">Ascolta il Riassunto</h2>
                    <div class="p-4 bg-teal-100/50 rounded-lg flex flex-col sm:flex-row items-center gap-4 w-full">
                        <audio controls src="audio_sinusiti.mp3" class="w-full sm:w-auto flex-grow rounded-lg">Il tuo browser non supporta l'elemento audio.</audio>
                        <a href="audio_sinusiti.mp3" download class="bg-teal-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-600 transition inline-flex items-center w-full sm:w-auto justify-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            <span data-lang-key="btnDownloadAudio">Scarica Audio</span>
                        </a>
                    </div>
                </section>

                <section id="bibliografia">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4" data-lang-key="bibliographyTitle">Riferimenti Bibliografici</h2>
                    <ul class="list-disc pl-6 text-teal-900" data-lang-key="bibliographyContent">
                        <!-- Content loaded by JS -->
                    </ul>
                </section>
            </article>
            
            <div class="mt-12 text-center">
                <button id="print-button" onclick="window.print()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition inline-flex items-center" data-lang-key="btnPrint">Stampa Riassunto</button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                siteTitle: { it: "Patologie Respiratorie", en: "Respiratory Diseases" },
                backToIndexText: { it: "Indice Patologie Respiratorie", en: "Respiratory Pathology Index" },
                pageTitle: { it: "Sinusiti nel Cavallo", en: "Equine Sinusitis" },
                pageSubtitle: { it: "Approccio diagnostico e terapeutico all'infiammazione dei seni paranasali.", en: "Diagnostic and therapeutic approach to paranasal sinus inflammation." },
                navSummary: { it: "Riassunto", en: "Summary" },
                navInfographic: { it: "Infografica", en: "Infographic" },
                navQuiz: { it: "Quiz", en: "Quiz" },
                navAudio: { it: "Audio", en: "Audio" },
                navBibliography: { it: "Bibliografia", en: "Bibliography" },
                summaryTitle: { it: "Riassunto Completo", en: "Full Summary" },
                summaryContent: { it: `<p>La sinusite nel cavallo è un'infiammazione dei seni paranasali. Può essere classificata come <strong>primaria</strong> (idiopatica o da infezioni delle prime vie aeree) o <strong>secondaria</strong> a patologie dentali, traumi, cisti o neoplasie.</p><p>Il segno clinico più comune è uno <strong>scolo nasale monolaterale</strong>, tipicamente mucopurulento e maleodorante, specialmente nelle forme secondarie a problemi dentali. Altri segni possono includere deformazione facciale, epifora e rumori respiratori anomali.</p><p>La diagnosi si basa su:</p><ul><li><strong>Esame clinico</strong> e anamnesi.</li><li><strong>Endoscopia</strong> delle vie aeree per visualizzare lo scolo provenire dal recesso naso-mascellare.<div class="my-4 p-4 border rounded-lg bg-gray-50"><p class="text-sm font-semibold text-gray-700 mb-2">Immagine Endoscopica</p><img src="endoscopia_sinusite.jpg" alt="Immagine endoscopica dei seni paranasali in un cavallo con sinusite" class="w-full max-w-md mx-auto rounded-lg shadow-md"><p class="text-center text-xs text-gray-500 mt-1">Scolo mucopurulento dal recesso naso-mascellare (freccia blu) e turbinati etmoidali (freccia rossa).</p></div></li><li><strong>Radiografia</strong> del cranio, che permette di visualizzare linee di fluido e opacità dei seni.</li><li><strong>Tomografia Computerizzata (TC)</strong>, che rappresenta il gold standard per una valutazione dettagliata.</li></ul><p>La terapia varia in base alla causa. Nelle forme primarie, si basa su lavaggi dei seni e terapia antibiotica sistemica. Nelle forme secondarie, è essenziale risolvere la causa sottostante (es. estrazione dentale). L'approccio chirurgico, come la creazione di un <strong>flap nasofrontale</strong>, può essere necessario per il debridement e il drenaggio.</p>`, en: `<p>Sinusitis in horses is an inflammation of the paranasal sinuses. It can be classified as <strong>primary</strong> (idiopathic or from upper respiratory infections) or <strong>secondary</strong> to dental diseases, trauma, cysts, or neoplasia.</p><p>The most common clinical sign is a <strong>unilateral nasal discharge</strong>, typically mucopurulent and foul-smelling, especially in forms secondary to dental problems. Other signs may include facial deformity, epiphora, and abnormal respiratory noises.</p><p>Diagnosis is based on:</p><ul><li><strong>Clinical examination</strong> and history.</li><li><strong>Endoscopy</strong> of the airways to visualize discharge from the nasomaxillary opening.<div class="my-4 p-4 border rounded-lg bg-gray-50"><p class="text-sm font-semibold text-gray-700 mb-2">Endoscopic Image</p><img src="endoscopia_sinusite.jpg" alt="Endoscopic image of paranasal sinuses in a horse with sinusitis" class="w-full max-w-md mx-auto rounded-lg shadow-md"><p class="text-center text-xs text-gray-500 mt-1">Mucopurulent discharge from the nasomaxillary opening (blue arrow) and ethmoid turbinates (red arrow).</p></div></li><li><strong>Skull radiography</strong>, which allows visualization of fluid lines and sinus opacities.</li><li><strong>Computed Tomography (CT)</strong>, which is the gold standard for detailed evaluation.</li></ul><p>Therapy varies depending on the cause. In primary forms, it is based on sinus lavage and systemic antibiotic therapy. In secondary forms, it is essential to resolve the underlying cause (e.g., tooth extraction). Surgical approaches, such as creating a <strong>nasofrontal flap</strong>, may be necessary for debridement and drainage.</p>` },
                infographicTitle: { it: "Infografica Riepilogativa", en: "Summary Infographic" },
                quizTitle: { it: "Quiz di Autovalutazione", en: "Self-Assessment Quiz" },
                quizSubmit: { it: "Verifica Risposte", en: "Check Answers" },
                audioTitle: { it: "Ascolta il Riassunto", en: "Listen to the Summary" },
                btnDownloadAudio: { it: "Scarica Audio", en: "Download Audio" },
                bibliographyTitle: { it: "Riferimenti Bibliografici", en: "Bibliographical References" },
                bibliographyContent: { it: "<li>Equine Internal Medicine, 4th Edition - Reed, Bayly, Sellon</li><li>Large Animal Internal Medicine, 6th Edition - Smith, Van Metre, Pusterla</li>", en: "<li>Equine Internal Medicine, 4th Edition - Reed, Bayly, Sellon</li><li>Large Animal Internal Medicine, 6th Edition - Smith, Van Metre, Pusterla</li>" },
                btnPrint: { it: "Stampa Riassunto", en: "Print Summary" },
                accessibility: { it: "Accessibilità", en: "Accessibility" },
            };

            const quizData = {
                it: [
                    { question: "Qual è il segno clinico più comune della sinusite equina?", options: ["Tosse secca", "Scolo nasale bilaterale", "Scolo nasale monolaterale", "Febbre alta"], answer: "Scolo nasale monolaterale" },
                    { question: "Qual è la causa più frequente di sinusite secondaria nel cavallo?", options: ["Traumi cranici", "Patologie dentali", "Cisti sinusali", "Infezioni virali"], answer: "Patologie dentali" },
                    { question: "Quale tecnica di imaging è considerata il gold standard per la diagnosi di sinusite?", options: ["Radiografia", "Ecografia", "Endoscopia", "Tomografia Computerizzata (TC)"], answer: "Tomografia Computerizzata (TC)" },
                    { question: "Cosa si intende per sinusite primaria?", options: ["Un'infezione causata da un ascesso dentale", "Un'infezione che origina nel seno senza un'altra causa sottostante", "Un'infezione che colpisce sempre entrambi i lati", "Un'infezione che richiede sempre un intervento chirurgico"], answer: "Un'infezione che origina nel seno senza un'altra causa sottostante" },
                    { question: "Qual è lo scopo principale della trapanazione sinusale nella terapia della sinusite?", options: ["Creare un drenaggio permanente", "Permettere il lavaggio del seno", "Eseguire una biopsia della mucosa", "Rimuovere un dente infetto"], answer: "Permettere il lavaggio del seno" },
                    { question: "Quali seni sono più frequentemente affetti da sinusite primaria?", options: ["Seno sfenopalatino e mascellare rostrale", "Seno mascellare caudale e seno frontale", "Seno etmoidale e mascellare caudale", "Solo il seno mascellare rostrale"], answer: "Seno mascellare caudale e seno frontale" },
                    { question: "Un odore fetido dallo scolo nasale è fortemente suggestivo di quale causa?", options: ["Un'origine virale", "Un'origine fungina", "Un'origine dentale", "Una cisti sinusale"], answer: "Un'origine dentale" },
                    { question: "Quale complicazione può derivare da una sinusite non trattata che coinvolge il seno sfenopalatino?", options: ["Laminite", "Segni neurologici", "Colica", "Insufficienza cardiaca"], answer: "Segni neurologici" },
                    { question: "Nella sinusite primaria, quale approccio antibiotico è raccomandato in attesa dell'antibiogramma?", options: ["Terapia a breve termine (3-5 giorni)", "Nessun antibiotico, solo FANS", "Terapia ad ampio spettro (aerobi e anaerobi)", "Solo antibiotici locali"], answer: "Terapia ad ampio spettro (aerobi e anaerobi)" },
                    { question: "Quale terapia di supporto è utile per fluidificare l'essudato e ridurre l'infiammazione?", options: ["Solo riposo a box", "Diuretici per ridurre il fluido", "Mucolitici e FANS", "Cortisonici ad alte dosi"], answer: "Mucolitici e FANS" }
                ],
                en: [
                    { question: "What is the most common clinical sign of equine sinusitis?", options: ["Dry cough", "Bilateral nasal discharge", "Unilateral nasal discharge", "High fever"], answer: "Unilateral nasal discharge" },
                    { question: "What is the most frequent cause of secondary sinusitis in horses?", options: ["Head trauma", "Dental disease", "Sinus cysts", "Viral infections"], answer: "Dental disease" },
                    { question: "Which imaging technique is considered the gold standard for diagnosing sinusitis?", options: ["Radiography", "Ultrasonography", "Endoscopy", "Computed Tomography (CT)"], answer: "Computed Tomography (CT)" },
                    { question: "What does 'primary sinusitis' refer to?", options: ["An infection caused by a tooth root abscess", "An infection originating in the sinus itself without another underlying cause", "An infection that always affects both sides", "An infection that always requires surgery"], answer: "An infection originating in the sinus itself without another underlying cause" },
                    { question: "What is the main purpose of sinus trephination in sinusitis therapy?", options: ["To create permanent drainage", "To allow for sinus flushing", "To perform a mucosal biopsy", "To remove an infected tooth"], answer: "To allow for sinus flushing" },
                    { question: "Which sinuses are most frequently affected by primary sinusitis?", options: ["Sphenopalatine and rostral maxillary sinus", "Caudal maxillary and frontal sinuses", "Ethmoidal and caudal maxillary sinus", "Only the rostral maxillary sinus"], answer: "Caudal maxillary and frontal sinuses" },
                    { question: "A foul odor from the nasal discharge is strongly suggestive of what cause?", options: ["A viral origin", "A fungal origin", "A dental origin", "A sinus cyst"], answer: "A dental origin" },
                    { question: "What complication can arise from untreated sinusitis involving the sphenopalatine sinus?", options: ["Laminitis", "Neurological signs", "Colic", "Heart failure"], answer: "Neurological signs" },
                    { question: "In primary sinusitis, which antibiotic approach is generally recommended pending culture results?", options: ["Short-term therapy (3-5 days)", "No antibiotics, only NSAIDs", "Broad-spectrum therapy (aerobic and anaerobic)", "Local antibiotics only"], answer: "Broad-spectrum therapy (aerobic and anaerobic)" },
                    { question: "What supportive therapy is useful to liquefy exudate and reduce inflammation?", options: ["Stall rest only", "Diuretics to reduce fluid", "Mucolytics and NSAIDs", "High-dose corticosteroids"], answer: "Mucolytics and NSAIDs" }
                ]
            };
            
            let currentLanguage = localStorage.getItem('language') || 'it';
            const synth = window.speechSynthesis;
            let currentUtterance = null;
            let activeTTSButton = null;

            function speak(text, button) {
                if (activeTTSButton === button) {
                    if (synth.paused) {
                        synth.resume();
                        button.classList.add('playing');
                    } else if (synth.speaking) {
                        synth.pause();
                        button.classList.remove('playing');
                    }
                    return;
                }

                if (synth.speaking) {
                    synth.cancel();
                }
                if (activeTTSButton) {
                    activeTTSButton.classList.remove('playing');
                }
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = currentLanguage === 'it' ? 'it-IT' : 'en-US';
                
                currentUtterance.onend = () => {
                    if (activeTTSButton) activeTTSButton.classList.remove('playing');
                    activeTTSButton = null;
                    currentUtterance = null;
                };
                currentUtterance.onerror = () => {
                    if (activeTTSButton) activeTTSButton.classList.remove('playing');
                    activeTTSButton = null;
                    currentUtterance = null;
                };

                synth.speak(currentUtterance);
                activeTTSButton = button;
                button.classList.add('playing');
            }

            function setupTTSListeners() {
                document.querySelectorAll('.tts-button').forEach(button => {
                    const newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                    
                    newButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        let textToRead = '';
                        const parentElement = newButton.parentElement;

                        if (parentElement.tagName === 'H2') {
                            const section = parentElement.closest('section');
                            let contentToRead = '';
                            if(section){
                                const clone = section.cloneNode(true);
                                clone.querySelectorAll('h2, button, a, img, audio, .tts-button, #quiz, #infografica, #audio, #bibliografia, [class*="my-4"]').forEach(el => el.remove());
                                contentToRead = clone.textContent.trim().replace(/\s\s+/g, ' ');
                            }
                            
                            const titleClone = parentElement.cloneNode(true);
                            titleClone.querySelector('.tts-button').remove();
                            textToRead = `${titleClone.textContent.trim()}. ${contentToRead}`;
                        } 
                        else if (parentElement.tagName === 'H3') {
                             const questionTextNode = parentElement.querySelector('span:first-child');
                             if (questionTextNode) {
                                textToRead = questionTextNode.textContent.trim().replace(/^\d+\.\s*/, '');
                             }
                        }
                        else if (parentElement.closest('label')) {
                            const label = parentElement.closest('label');
                            const answerTextNode = label.querySelector('span:first-child');
                            if (answerTextNode) {
                                textToRead = answerTextNode.textContent.trim();
                            }
                        }
                        
                        if (textToRead) {
                            speak(textToRead, newButton);
                        }
                    });
                });
            }

            function loadQuiz(lang) {
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.innerHTML = '';
                document.getElementById('quiz-results').innerHTML = ''; 
                quizData[lang].forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'quiz-question p-4 rounded-lg';
                    let optionsHtml = q.options.map(o => `
                        <li class="quiz-option p-2 rounded hover:bg-teal-50">
                            <label class="flex items-center justify-between w-full cursor-pointer">
                                <span class="flex-grow pr-4"><input type="radio" name="q${index}" value="${o}" class="mr-3">${o}</span>
                                <span class="tts-button flex-shrink-0"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span>
                            </label>
                        </li>`).join('');
                    questionDiv.innerHTML = `<h3 class="font-semibold mb-2 flex items-center justify-between"><span>${index + 1}. ${q.question}</span><span class="tts-button"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h3><ul class="space-y-1">${optionsHtml}</ul>`;
                    quizContainer.appendChild(questionDiv);
                });
            }

            function updateLanguage(lang) {
                document.documentElement.lang = lang;
                document.getElementById('lang-toggle').textContent = lang === 'it' ? 'EN' : 'IT';
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[key] && translations[key][lang]) {
                        if (key.includes('Content')) {
                             element.innerHTML = translations[key][lang];
                        } else {
                            const ttsButton = element.querySelector('.tts-button');
                            element.textContent = translations[key][lang];
                            if(ttsButton) element.appendChild(ttsButton);
                        }
                    }
                });
                const dsaToggle = document.getElementById('accessibility-toggle');
                if (document.body.classList.contains('dsa-mode')) {
                    dsaToggle.textContent = lang === 'it' ? 'Vista Standard' : 'Standard View';
                } else {
                    dsaToggle.textContent = lang === 'it' ? 'Accessibilità' : 'Accessibility';
                }
                loadQuiz(lang);
                setupTTSListeners();
            }
            
            document.getElementById('lang-toggle').addEventListener('click', () => {
                currentLanguage = currentLanguage === 'it' ? 'en' : 'it';
                localStorage.setItem('language', currentLanguage);
                updateLanguage(currentLanguage);
            });

            const dsaToggle = document.getElementById('accessibility-toggle');
            dsaToggle.addEventListener('click', () => {
                document.body.classList.toggle('dsa-mode');
                 if (document.body.classList.contains('dsa-mode')) {
                    dsaToggle.textContent = currentLanguage === 'it' ? 'Vista Standard' : 'Standard View';
                } else {
                    dsaToggle.textContent = currentLanguage === 'it' ? 'Accessibilità' : 'Accessibility';
                }
            });

            document.getElementById('submit-quiz').addEventListener('click', () => {
                let score = 0;
                const questions = document.querySelectorAll('.quiz-question');
                quizData[currentLanguage].forEach((q, index) => {
                    const selected = document.querySelector(`input[name="q${index}"]:checked`);
                    questions[index].classList.remove('correct', 'incorrect');
                    if (selected) {
                        if (selected.value === q.answer) {
                            score++;
                            questions[index].classList.add('correct');
                        } else {
                            questions[index].classList.add('incorrect');
                        }
                    } else {
                         questions[index].classList.add('incorrect');
                    }
                });
                const resultsContainer = document.getElementById('quiz-results');
                const resultText = {
                    it: `Hai risposto correttamente a ${score} su ${quizData.it.length} domande.`,
                    en: `You answered ${score} out of ${quizData.en.length} questions correctly.`
                };
                resultsContainer.textContent = resultText[currentLanguage];
            });

            updateLanguage(currentLanguage);
        });
    </script>
</body>
</html>
