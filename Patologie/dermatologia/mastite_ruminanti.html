<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastite nei Ruminanti - Medicina Interna Veterinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fffbeb; color: #713f12; }
        .content-section { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .nav-link { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .nav-link:hover, .nav-link.active { border-bottom-color: #f59e0b; color: #d97706; }
        
        .dsa-mode {
            font-family: 'Lexend', sans-serif;
            background-color: #f8fafc !important;
            letter-spacing: 0.05em;
            line-height: 1.75;
            color: #34495e;
        }
        .dsa-mode #main-header, .dsa-mode #main-footer { background-color: #000000 !important; }
        .dsa-mode #main-header h1, .dsa-mode #main-header a, .dsa-mode #main-footer p, .dsa-mode button { color: #ffffff !important; }
        .dsa-mode button { border: 1px solid #ffffff; }
        .dsa-mode .content-section { background-color: #fffdfd; border: 1px solid #e0e0e0; }
        
        .tts-button { 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            margin-left: 12px; 
            color: #f59e0b; 
            transition: all 0.2s; 
            vertical-align: middle;
            height: 0.8em;
            width: 0.8em;
            position: relative;
            top: -0.05em;
        }
        .tts-button svg { width: 100%; height: 100%; }
        .tts-button:hover, .tts-button.playing { color: #d97706; transform: scale(1.1); }
        .tts-button.paused { opacity: 0.6; }
        
        .quiz-question { border: 1px solid #fde68a; transition: all 0.3s; }
        .quiz-option:hover { background-color: #fffbeb; }
        .quiz-question.correct { background-color: #d1fae5; border-color: #10b981; }
        .quiz-question.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        
        @media print {
            #main-header, #main-footer, #page-nav, #infografica, #quiz, #audio, #print-button, .tts-button, video, img { display: none; }
        }
    </style>
</head>
<body class="bg-amber-50">

    <header id="main-header" class="bg-amber-800 text-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center flex-wrap">
            <h1 class="text-xl font-bold !text-white !border-none !m-0 !p-0 !text-left" data-lang-key="siteTitle">Patologie Dermatologiche</h1>
            <div class="flex items-center space-x-4">
                <button id="accessibility-toggle" aria-label="Attiva modalit√† ad alta leggibilit√†" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition" data-lang-key="accessibility">Accessibilit√†</button>
                <button id="lang-toggle" aria-label="Change language" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition">EN</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-10">
        <div class="text-left mb-8">
            <a href="index.html" class="inline-flex items-center bg-white text-amber-700 font-bold py-2 px-4 rounded-lg shadow hover:bg-amber-100 transition duration-300">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path></svg>
                <span data-lang-key="backToIndexText">Indice Dermatologia</span>
            </a>
        </div>
        
        <div class="content-section p-6 md:p-10">
            <header class="text-center border-b-2 border-amber-200 pb-6 mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-amber-800" data-lang-key="pageTitle">
                    Mastite nei Ruminanti
                    <span class="tts-button">
                        <svg fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg>
                    </span>
                </h1>
                <p class="text-lg text-amber-700 mt-2" data-lang-key="pageSubtitle">Approccio integrato alla patologia mammaria nei bovini e piccoli ruminanti.</p>
            </header>

            <nav id="page-nav" class="flex justify-center flex-wrap gap-4 md:gap-8 mb-10 border-b border-gray-200">
                <a href="#riassunto" class="nav-link font-semibold py-2" data-lang-key="navSummary">Riassunto</a>
                <a href="#infografica" class="nav-link font-semibold py-2" data-lang-key="navInfographic">Infografica</a>
                <a href="#quiz" class="nav-link font-semibold py-2" data-lang-key="navQuiz">Quiz</a>
                <a href="#audio" class="nav-link font-semibold py-2" data-lang-key="navAudio">Audio</a>
                <a href="#bibliografia" class="nav-link font-semibold py-2" data-lang-key="navBibliography">Bibliografia</a>
            </nav>

            <article class="space-y-12">
                <section id="riassunto">
                    <h2 class="text-3xl font-bold text-amber-700 mb-4 flex items-center" data-lang-key="summaryTitle">
                        Riassunto Completo 
                        <span class="tts-button">
                            <svg fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg>
                        </span>
                    </h2>
                    <div class="prose max-w-none text-amber-900" data-lang-key="summaryContent">
                        <!-- Content via JS -->
                    </div>
                </section>

                <section id="infografica">
                    <h2 class="text-3xl font-bold text-amber-700 mb-4" data-lang-key="infographicTitle">Infografica Riepilogativa</h2>
                    <a href="infografica_mastite_ruminanti.html" target="_blank" class="block bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow border-l-4 border-amber-500">
                         <div class="flex items-center space-x-6">
                            <div class="flex-shrink-0 w-24 h-24 bg-amber-500 rounded-lg flex items-center justify-center">
                                <span class="text-5xl" role="img" aria-label="Icona mammella">ü•õ</span>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-amber-800" data-lang-key="infographicLinkTitle">Visualizza l'Infografica: Gestione Mastite</h3>
                                <p class="text-gray-600 mt-1" data-lang-key="infographicLinkDesc">Algoritmo per la diagnosi differenziale e protocolli di mungitura.</p>
                            </div>
                         </div>
                    </a>
                </section>

                <section id="quiz">
                    <h2 class="text-3xl font-bold text-amber-700 mb-4" data-lang-key="quizTitle">Quiz di Autovalutazione</h2>
                    <div id="quiz-container" class="space-y-6"></div>
                    <div class="mt-6 text-center">
                        <button id="submit-quiz" class="bg-amber-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-700 transition" data-lang-key="quizSubmit">Verifica Risposte</button>
                    </div>
                    <div id="quiz-results" class="mt-6 text-center text-xl font-bold"></div>
                </section>

                <section id="audio">
                    <h2 class="text-3xl font-bold text-amber-700 mb-4" data-lang-key="audioTitle">Ascolta il Riassunto</h2>
                    <div class="p-4 bg-amber-100/50 rounded-lg flex flex-col sm:flex-row items-center gap-4 w-full">
                        <button id="audio-play-pause" class="p-3 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors duration-200">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.27l9.344-5.89a1.5 1.5 0 002.3 1.27l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" /></svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" viewBox="0 0 20 20" fill="currentColor"><path d="M5.75 4.5a.75.75 0 00-.75.75v10a.75.75 0 001.5 0v-10a.75.75 0 00-.75-.75zM14.25 4.5a.75.75 0 00-.75.75v10a.75.75 0 001.5 0v-10a.75.75 0 00-.75-.75z" /></svg>
                        </button>
                        <div class="flex-grow text-center sm:text-left">
                            <p class="font-semibold text-amber-800" data-lang-key="audioListen">Ascolta il riassunto completo</p>
                        </div>
                        <a href="audio_mastite.mp3" download class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition inline-flex items-center w-full sm:w-auto justify-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            <span data-lang-key="btnDownloadAudio">Scarica</span>
                        </a>
                    </div>
                </section>

                <section id="bibliografia">
                    <h2 class="text-3xl font-bold text-amber-700 mb-4" data-lang-key="bibliographyTitle">Riferimenti Bibliografici</h2>
                    <ul id="bib-list" class="list-disc pl-6 text-amber-900" data-lang-key="bibliographyContent"></ul>
                </section>
            </article>
            
            <div class="mt-12 text-center">
                <button id="print-button" onclick="window.print()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition inline-flex items-center" data-lang-key="btnPrint">Stampa Riassunto</button>
            </div>
        </div>
    </main>

    <footer id="main-footer" class="text-center mt-16 pt-8 border-t border-amber-100 pb-10">
        <p class="text-slate-500" data-lang-key="footer-credit">A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var translations = {
                siteTitle: { it: "Patologie Dermatologiche", en: "Dermatological Diseases" },
                backToIndexText: { it: "Indice Dermatologia", en: "Dermatology Index" },
                pageTitle: { it: "Mastite nei Ruminanti", en: "Ruminant Mastitis" },
                pageSubtitle: { it: "Approccio integrato alla patologia mammaria nei bovini e piccoli ruminanti.", en: "Integrated approach to mammary pathology in cattle and small ruminants." },
                navSummary: { it: "Riassunto", en: "Summary" },
                navInfographic: { it: "Infografica", en: "Infographic" },
                navQuiz: { it: "Quiz", en: "Quiz" },
                navAudio: { it: "Audio", en: "Audio" },
                navBibliography: { it: "Bibliografia", en: "Bibliography" },
                summaryTitle: { it: "Riassunto Completo", en: "Full Summary" },
                summaryContent: { 
                    it: `<p>La <strong>mastite</strong> √® l'infiammazione della ghiandola mammaria, generalmente causata da agenti batterici che penetrano attraverso il canale del capezzolo. Rappresenta la patologia con il maggior impatto economico nell'allevamento lattiero-caseario.</p>
                        
                        <h3 class="text-2xl font-semibold mt-6 mb-3">1. Eziologia Generale</h3>
                        <p>Gli agenti eziologici vengono classicamente divisi in due gruppi:</p>
                        <ul class="list-disc pl-6 space-y-2">
                            <li><strong>Agenti Contagiosi:</strong> Adattati alla mammella, si trasmettono durante la mungitura (es. <em>Staphylococcus aureus</em>, <em>Streptococcus agalactiae</em>).</li>
                            <li><strong>Agenti Ambientali:</strong> Presenti nelle lettiere e nelle feci, penetrano nei momenti di bassa difesa immunitaria o scarsa igiene (es. <em>Escherichia coli</em>, <em>Streptococcus uberis</em>).</li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">2. Peculiarit√† dei Grandi Ruminanti (Bovini)</h3>
                        <ul class="list-disc pl-6 space-y-2">
                            <li><strong>Mastite Clinica vs Subclinica:</strong> Nel bovino la forma subclinica √® prevalente, diagnosticata tramite l'aumento delle <strong>Cellule Somatiche (SCC)</strong>.</li>
                            <li><strong>Mastite Iperacuta da Gram-negativi:</strong> Causata spesso da <em>E. coli</em>, caratterizzata da endotossiemia grave, febbre, anoressia e secrezione mammaria sierosa.</li>
                            <li><strong>Diagnostica:</strong> Uso sistematico del <strong>California Mastitis Test (CMT)</strong> a bordo stalla.</li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">3. Peculiarit√† dei Piccoli Ruminanti (Ovini e Caprini)</h3>
                        <ul class="list-disc pl-6 space-y-2">
                            <li><strong>Mastite Gangrenosa:</strong> Forma acuta molto comune in pecora e capra, spesso causata da <em>Staphylococcus aureus</em> o <em>Clostridium perfringens</em>. Caratterizzata da freddezza, colorazione bluastra della mammella (cianosi) e successiva <strong>necrosi</strong> del tessuto.</li>
                            <li><strong>Agalassia Contagiosa:</strong> Causata da <em>Mycoplasma agalactiae</em>. Si manifesta con mastite, artrite e cheratocongiuntivite.</li>
                            <li><strong>Cellule Somatiche:</strong> Nella capra, i valori fisiologici delle SCC sono naturalmente pi√π elevati rispetto al bovino a causa della secrezione apocrina.</li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">4. Diagnosi e Controllo</h3>
                        <p>Il controllo si basa sulla gestione dell'igiene e sulla prevenzione delle contaminazioni crociate:</p>
                        <ul class="list-disc pl-6 space-y-2">
                            <li>Corretto funzionamento e igiene dell'impianto di mungitura.</li>
                            <li>Disinfezione dei capezzoli post-mungitura (Post-dipping).</li>
                            <li><strong>Gestione dei Positivi:</strong> Gli animali identificati come infetti devono essere <strong>munti per ultimi</strong> per prevenire la trasmissione agli animali sani.</li>
                            <li>Trattamento dei casi clinici, terapia in asciutta e riforma dei cronici.</li>
                        </ul>`,
                    en: `<p><strong>Mastitis</strong> is the inflammation of the mammary gland. It is a major cause of economic loss.</p>
                        <h3 class="text-2xl font-semibold mt-6 mb-3">1. Etiology</h3><p>Classified into Contagious and Environmental.</p>
                        <h3 class="text-2xl font-semibold mt-6 mb-3">2. Bovine Peculiarities</h3><p>High prevalence of subclinical forms. SCC monitoring is essential.</p>
                        <h3 class="text-2xl font-semibold mt-6 mb-3">3. Small Ruminant Peculiarities</h3><ul class="list-disc pl-6 space-y-2"><li><strong>Gangrenous Mastitis:</strong> Leading to tissue <strong>necrosis</strong>.</li><li><strong>Contagious Agalactia:</strong> <em>Mycoplasma</em> infection (Mastitis + Arthritis).</li></ul>
                        <h3 class="text-2xl font-semibold mt-6 mb-3">4. Control</h3><ul class="list-disc pl-6 space-y-2"><li>Post-dipping and hygiene.</li><li><strong>Positive Management:</strong> Milk positive animals last to avoid cross-contamination.</li></ul>`
                },
                infographicLinkTitle: { it: "Visualizza l'Infografica: Gestione Mastite", en: "View Infographic: Mastitis Management" },
                infographicLinkDesc: { it: "Algoritmo per la diagnosi differenziale e protocolli di mungitura.", en: "Algorithm for differential diagnosis and milking protocols." },
                quizTitle: { it: "Quiz di Autovalutazione", en: "Self-Assessment Quiz" },
                quizSubmit: { it: "Verifica Risposte", en: "Check Answers" },
                audioTitle: { it: "Ascolta il Riassunto", en: "Listen to the Summary" },
                btnDownloadAudio: { it: "Scarica", en: "Download" },
                audioListen: { it: "Ascolta il riassunto completo", en: "Listen to the full summary" },
                bibliographyTitle: { it: "Riferimenti Bibliografici", en: "Bibliographical References" },
                bibliographyContent: { 
                    it: `<li>Smith BP, Large Animal Internal Medicine, 5th Edition, Mosby, 2017.</li>`,
                    en: `<li>Smith BP, Large Animal Internal Medicine, 5th Edition, Mosby, 2017.</li>`
                },
                btnPrint: { it: "Stampa Riassunto", en: "Print Summary" },
                accessibility: { it: "Accessibilit√†", en: "Accessibility" },
                "footer-credit": { it: "A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria", en: "Curated by Prof. Sara Busechian. Veterinary clinical medicine teachings" }
            };

            var quizData = {
                it: [
                    { question: "Qual √® la differenza principale tra agenti contagiosi e ambientali?", options: ["I contagiosi vivono nel suolo, gli ambientali nelle condutture idriche", "I contagiosi si trasmettono durante la mungitura, gli ambientali dall'ambiente di stalla (es. lettiera)", "I contagiosi sono parassiti, gli ambientali sono virus", "Non c'√® differenza"], answer: "I contagiosi si trasmettono durante la mungitura, gli ambientali dall'ambiente di stalla (es. lettiera)" },
                    { question: "Quale reperto clinico caratterizza la mastite gangrenosa nei piccoli ruminanti?", options: ["Mammella molto calda e rossa", "Mammella fredda, bluastra e necrotica", "Aumento della produzione di latte", "Pelo lucido"], answer: "Mammella fredda, bluastra e necrotica" },
                    { question: "L'Agalassia Contagiosa √® causata da:", options: ["Staphylococcus aureus", "Mycoplasma agalactiae", "E. coli", "Clostridium"], answer: "Mycoplasma agalactiae" },
                    { question: "Perch√© le Cellule Somatiche (SCC) sono naturalmente pi√π alte nella capra rispetto alla vacca?", options: ["Perch√© le capre sono sempre malate", "A causa del tipo di secrezione apocrina della ghiandola", "Perch√© mangiano pi√π erba", "Non sono pi√π alte"], answer: "A causa del tipo di secrezione apocrina della ghiandola" },
                    { question: "Il CMT (California Mastitis Test) serve a stimare:", options: ["Il contenuto di grasso", "Il numero di cellule somatiche nel latte", "La presenza di antibiotici", "Il sapore del latte"], answer: "Il numero di cellule somatiche nel latte" },
                    { question: "Quale batterio causa spesso mastiti iperacute con endotossiemia nel bovino?", options: ["Strep. agalactiae", "E. coli", "Mycoplasma", "Listeria"], answer: "E. coli" },
                    { question: "Quale misura di controllo √® essenziale per evitare contaminazioni crociate?", options: ["Mungere i sani dopo gli infetti", "Mungere gli animali positivi per ultimi", "Pulire solo l'impianto a fine giornata", "Utilizzare gli stessi panni per tutti i capi"], answer: "Mungere gli animali positivi per ultimi" },
                    { question: "Oltre alla mastite, l'Agalassia Contagiosa coinvolge spesso:", options: ["Cuore e Polmoni", "Articolazioni e Occhi", "Fegato e Reni", "Solo la mammella"], answer: "Articolazioni e Occhi" },
                    { question: "Cosa si intende per mastite subclinica?", options: ["Mammella con ascessi visibili", "Infezione senza alterazioni visibili della mammella o del latte", "Guarigione totale", "Infezione delle ossa"], answer: "Infezione senza alterazioni visibili della mammella o del latte" },
                    { question: "La terapia in asciutta serve a:", options: ["Far produrre pi√π latte", "Prevenire nuove infezioni e curare quelle esistenti durante il riposo mammario", "Lavare l'impianto", "Preparare l'animale alla fiera"], answer: "Prevenire nuove infezioni e curare quelle esistenti durante il riposo mammario" }
                ],
                en: [
                    { question: "What is the main difference between contagious and environmental agents?", options: ["Contagious live in soil, environmental in water pipes", "Contagious spread during milking, environmental from the stall environment (e.g., bedding)", "Contagious are parasites, environmental are viruses", "There is no difference"], answer: "Contagious spread during milking, environmental from the stall environment (e.g., bedding)" },
                    { question: "Gangrenous mastitis in sheep/goats is characterized by:", options: ["Hot red udder", "Cold, bluish, and necrotic tissue", "Increased milk flow", "Shiny coat"], answer: "Cold, bluish, and necrotic tissue" },
                    { question: "CMT (California Mastitis Test) estimates:", options: ["Fat content", "Somatic cell count in milk", "Antibiotics", "Protein levels"], answer: "Somatic cell count in milk" },
                    { question: "Causative agent of Contagious Agalactia?", options: ["S. aureus", "Mycoplasma agalactiae", "E. coli", "Strep. uberis"], answer: "Mycoplasma agalactiae" },
                    { question: "Essential control measure for positive animals?", options: ["Milk healthy after infected", "Milk positive animals last", "Clean system only once daily", "Use same cloths for all cows"], answer: "Milk positive animals last" }
                ]
            };

            var currentLanguage = localStorage.getItem('language') || 'it';
            var synth = window.speechSynthesis;
            var currentUtterance = null;
            var activeTTSButton = null;

            function stopSpeech() { if (synth.speaking || synth.paused) { synth.cancel(); } }
            
            function speak(text, button) {
                if (activeTTSButton === button) {
                    if (synth.paused) { synth.resume(); button.classList.add('playing'); } 
                    else if (synth.speaking) { synth.pause(); button.classList.remove('playing'); }
                    return; 
                }
                stopSpeech();
                if(activeTTSButton) { activeTTSButton.classList.remove('playing'); }
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = currentLanguage === 'it' ? 'it-IT' : 'en-US';
                currentUtterance.onstart = function() { button.classList.add('playing'); activeTTSButton = button; };
                currentUtterance.onend = function() { button.classList.remove('playing'); if (activeTTSButton === button) activeTTSButton = null; };
                synth.speak(currentUtterance);
            }

            function setupTTSListeners() {
                document.querySelectorAll('.tts-button').forEach(function(button) {
                    var newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                    newButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        var textToRead = '';
                        var parentElement = newButton.parentElement;
                        if (parentElement.tagName === 'H1' || parentElement.tagName === 'H2') {
                            var titleClone = parentElement.cloneNode(true);
                            var btnInClone = titleClone.querySelector('.tts-button');
                            if(btnInClone) btnInClone.remove();
                            textToRead = titleClone.textContent.trim();
                            if (parentElement.tagName === 'H2' && parentElement.closest('section')?.id === 'riassunto') {
                                var content = document.querySelector('[data-lang-key="summaryContent"]');
                                if (content) textToRead += '. ' + content.textContent.trim();
                            }
                        }
                        if (textToRead) speak(textToRead, newButton);
                    });
                });
            }

            function loadQuiz(lang) {
                var container = document.getElementById('quiz-container');
                if(!container) return;
                container.innerHTML = '';
                quizData[lang].forEach(function(q, i) {
                    var div = document.createElement('div');
                    div.className = 'quiz-question p-4 rounded-lg';
                    var optionsHtml = q.options.map(function(o) {
                        return `<li class="quiz-option p-2 rounded hover:bg-amber-50"><label class="flex items-center w-full cursor-pointer"><input type="radio" name="q${i}" value="${o}" class="mr-3">${o}</label></li>`;
                    }).join('');
                    div.innerHTML = `<h3 class="font-semibold mb-2">${i + 1}. ${q.question}</h3><ul class="space-y-1">${optionsHtml}</ul>`;
                    container.appendChild(div);
                });
            }

            function updateLanguage(lang) {
                document.documentElement.lang = lang;
                document.getElementById('lang-toggle').textContent = lang === 'it' ? 'EN' : 'IT';
                document.querySelectorAll('[data-lang-key]').forEach(function(element) {
                    var key = element.dataset.langKey;
                    if (translations[key] && translations[key][lang]) {
                        if (key.includes('Content')) { element.innerHTML = translations[key][lang]; } 
                        else {
                            var btn = element.querySelector('.tts-button');
                            var text = translations[key][lang];
                            var childs = Array.from(element.childNodes);
                            var textNode = childs.find(function(n) { return n.nodeType === 3 && n.textContent.trim().length > 0; });
                            
                            if (textNode) { textNode.textContent = text; } 
                            else { element.textContent = text; if (btn) element.appendChild(btn); }
                        }
                    }
                });
                var toggle = document.getElementById('accessibility-toggle');
                if (toggle) toggle.textContent = document.body.classList.contains('dsa-mode') ? (lang === 'it' ? 'Standard' : 'Standard') : (lang === 'it' ? 'Accessibilit√†' : 'Accessibility');
                loadQuiz(lang);
                setupTTSListeners();
            }

            document.getElementById('lang-toggle').addEventListener('click', function() {
                currentLanguage = (currentLanguage === 'it' ? 'en' : 'it');
                localStorage.setItem('language', currentLanguage);
                stopSpeech();
                updateLanguage(currentLanguage);
            });

            document.getElementById('accessibility-toggle').addEventListener('click', function() {
                document.body.classList.toggle('dsa-mode');
                updateLanguage(currentLanguage);
            });

            document.getElementById('submit-quiz').addEventListener('click', function() {
                var score = 0;
                var qs = document.querySelectorAll('.quiz-question');
                quizData[currentLanguage].forEach(function(q, i) {
                    var sel = document.querySelector('input[name="q'+i+'"]:checked');
                    qs[i].classList.remove('correct', 'incorrect');
                    if (sel && sel.value === q.answer) { score++; qs[i].classList.add('correct'); }
                    else qs[i].classList.add('incorrect');
                });
                document.getElementById('quiz-results').textContent = (currentLanguage === 'it' ? 'Punteggio: ' : 'Score: ') + score + '/' + quizData[currentLanguage].length;
            });

            updateLanguage(currentLanguage);
        });
    </script>
</body>
</html>
