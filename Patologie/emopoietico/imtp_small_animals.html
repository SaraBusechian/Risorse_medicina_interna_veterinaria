<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMTP - Medicina Interna Veterinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fef2f2; color: #7f1d1d; } /* red-50, red-900 */
        .content-section { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .nav-link { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .nav-link:hover, .nav-link.active { border-bottom-color: #ef4444; color: #b91c1c; }
        .dsa-mode {
            font-family: 'Lexend', sans-serif;
            background-color: #f8fafc !important;
            letter-spacing: 0.05em;
            line-height: 1.75;
            color: #334155;
        }
        .dsa-mode #main-header, .dsa-mode #main-footer { background-color: #1e293b !important; }
        .dsa-mode #main-header h1, .dsa-mode #main-header a, .dsa-mode #main-footer p, .dsa-mode button { color: #ffffff !important; }
        .dsa-mode button { border: 1px solid #ffffff; }
        .dsa-mode .content-section { background-color: #ffffff; border: 1px solid #cbd5e1; }
        .dsa-mode h1, .dsa-mode h2, .dsa-mode h3, .dsa-mode p, .dsa-mode li { color: #0f172a; }
        .tts-button { cursor: pointer; display: inline-flex; align-items: center; justify-content: center; margin-left: 10px; vertical-align: middle; color: #dc2626; transition: color 0.2s; }
        .tts-button:hover, .tts-button.playing { color: #b91c1c; }
        .quiz-question { border: 1px solid #fecaca; transition: all 0.3s; }
        .quiz-option:hover { background-color: #fef2f2; }
        .quiz-question.correct { background-color: #d1fae5; border-color: #10b981; }
        .quiz-question.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        @media print {
            #main-header, #main-footer, #page-nav, #infografica, #quiz, #audio, #print-button, .tts-button, video, img, a[href*="infografica"] { display: none; }
        }
    </style>
</head>
<body class="bg-red-50">

    <header id="main-header" class="bg-red-800 text-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center flex-wrap">
            <h1 class="text-xl font-bold !text-white !border-none !m-0 !p-0 !text-left" data-lang-key="siteTitle">Patologie Sistema Emopoietico</h1>
            <div class="flex items-center space-x-4">
                <button id="accessibility-toggle" aria-label="Attiva modalit√† ad alta leggibilit√†" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition" data-lang-key="accessibility">Accessibilit√†</button>
                <button id="lang-toggle" aria-label="Change language" class="text-sm font-semibold px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition">EN</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-10">
        <div class="text-left mb-8">
            <a href="index.html" class="inline-flex items-center bg-white text-red-700 font-bold py-2 px-4 rounded-lg shadow hover:bg-red-100 transition duration-300" data-lang-key="backToIndex">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path></svg>
                <span data-lang-key="backToIndexText">Indice Patologie</span>
            </a>
        </div>
        
        <div class="content-section p-6 md:p-10">
            <header class="text-center border-b-2 border-red-200 pb-6 mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-red-800" data-lang-key="pageTitle">Trombocitopenia Immuno-Mediata (IMTP)<span class="tts-button"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h1>
                <p class="text-lg text-red-700 mt-2" data-lang-key="pageSubtitle">Distruzione piastrinica su base immunomediata nel cane e nel gatto.</p>
            </header>

            <nav id="page-nav" class="flex justify-center flex-wrap gap-4 md:gap-8 mb-10 border-b border-gray-200">
                <a href="#riassunto" class="nav-link font-semibold py-2" data-lang-key="navSummary">Riassunto</a>
                <a href="#infografica" class="nav-link font-semibold py-2" data-lang-key="navInfographic">Infografica</a>
                <a href="#quiz" class="nav-link font-semibold py-2" data-lang-key="navQuiz">Quiz</a>
                <a href="#audio" class="nav-link font-semibold py-2" data-lang-key="navAudio">Audio</a>
                <a href="#bibliografia" class="nav-link font-semibold py-2" data-lang-key="navBibliography">Bibliografia</a>
            </nav>

            <article class="space-y-12">
                <section id="riassunto">
                    <h2 class="text-3xl font-bold text-red-700 mb-4 flex items-center" data-lang-key="summaryTitle">Riassunto Completo <span class="tts-button"><svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h2>
                    <div class="prose max-w-none text-red-900" data-lang-key="summaryContent">
                        <!-- Content loaded by JS -->
                    </div>
                </section>

                <section id="infografica">
                    <h2 class="text-3xl font-bold text-red-700 mb-4" data-lang-key="infographicTitle">Infografica Riepilogativa</h2>
                      <a href="infografica_imtp_small_animals.html" target="_blank" class="block bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow border-l-4 border-red-500">
                          <div class="flex items-center space-x-6">
                              <div class="flex-shrink-0 w-24 h-24 bg-red-500 rounded-lg flex items-center justify-center">
                                  <span class="text-5xl" role="img" aria-label="Icona piastrine">üìâ</span>
                              </div>
                              <div>
                                  <h3 class="text-xl font-bold text-red-800" data-lang-key="infographicLinkTitle">Visualizza l'Infografica Dettagliata</h3>
                                  <p class="text-gray-600 mt-1" data-lang-key="infographicLinkDesc">Schema visivo: Soglia di pericolo, Diagnosi differenziale e Terapia.</p>
                              </div>
                          </div>
                      </a>
                </section>

                <section id="quiz">
                    <h2 class="text-3xl font-bold text-red-700 mb-4" data-lang-key="quizTitle">Quiz di Autovalutazione</h2>
                    <div id="quiz-container" class="space-y-6">
                        <!-- Questions loaded by JS -->
                    </div>
                    <div class="mt-6 text-center">
                        <button id="submit-quiz" class="bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-700 transition" data-lang-key="quizSubmit">Verifica Risposte</button>
                    </div>
                    <div id="quiz-results" class="mt-6 text-center text-xl font-bold"></div>
                </section>

                <section id="audio">
                    <h2 class="text-3xl font-bold text-red-700 mb-4" data-lang-key="audioTitle">Ascolta il Riassunto</h2>
                    <div class="p-4 bg-red-100/50 rounded-lg flex flex-col sm:flex-row items-center gap-4 w-full">
                        <button id="audio-play-pause" class="p-3 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors duration-200">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M6.3 2.841A1.5 1.5 0 004 4.11v11.78a1.5 1.5 0 002.3 1.27l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" /></svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" viewBox="0 0 20 20" fill="currentColor"><path d="M5.75 4.5a.75.75 0 00-.75.75v10a.75.75 0 001.5 0v-10a.75.75 0 00-.75-.75zM14.25 4.5a.75.75 0 00-.75.75v10a.75.75 0 001.5 0v-10a.75.75 0 00-.75-.75z" /></svg>
                        </button>
                        <div class="flex-grow text-center sm:text-left">
                            <p class="font-semibold text-red-800" data-lang-key="audioListen">Ascolta il riassunto completo</p>
                            <p class="text-sm text-red-600" data-lang-key="audioDesc">Audio lezione sintetica.</p>
                        </div>
                        <a href="audio_imtp_small_animals.mp3" download class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition inline-flex items-center w-full sm:w-auto justify-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            <span data-lang-key="btnDownloadAudio">Scarica</span>
                        </a>
                    </div>
                </section>

                <section id="bibliografia">
                    <h2 class="text-3xl font-bold text-red-700 mb-4" data-lang-key="bibliographyTitle">Riferimenti Bibliografici</h2>
                    <ul class="list-disc pl-6 text-red-900" data-lang-key="bibliographyContent">
                        <!-- Content loaded by JS -->
                    </ul>
                </section>
            </article>
            
            <div class="mt-12 text-center">
                <button id="print-button" onclick="window.print()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition inline-flex items-center" data-lang-key="btnPrint">Stampa Riassunto</button>
            </div>
        </div>
    </main>
    <footer id="main-footer" class="text-center mt-16 pt-8 border-t border-red-100">
        <p class="text-slate-500" data-lang-key="footer-credit">A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria</p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                siteTitle: { it: "Patologie Sistema Emopoietico", en: "Hematopoietic System Diseases" },
                backToIndexText: { it: "Indice Patologie", en: "Pathology Index" },
                pageTitle: { it: "Trombocitopenia Immuno-Mediata (IMTP)", en: "Immune-Mediated Thrombocytopenia (IMTP)" },
                pageSubtitle: { it: "Distruzione piastrinica su base immunomediata nel cane e nel gatto.", en: "Immune-mediated platelet destruction in dogs and cats." },
                navSummary: { it: "Riassunto", en: "Summary" },
                navInfographic: { it: "Infografica", en: "Infographic" },
                navQuiz: { it: "Quiz", en: "Quiz" },
                navAudio: { it: "Audio", en: "Audio" },
                navBibliography: { it: "Bibliografia", en: "Bibliography" },
                summaryTitle: { it: "Riassunto Completo", en: "Full Summary" },
                summaryContent: { 
                    it: `<p>L'<strong>IMTP (Immune-Mediated Thrombocytopenia)</strong> √® una condizione in cui anticorpi (generalmente IgG) si legano agli antigeni di superficie delle piastrine, causandone la distruzione precoce nel sistema reticoloendoteliale (soprattutto milza). √à la causa pi√π comune di trombocitopenia grave nel cane.</p>
                        
                        [Image of mechanism of immune mediated hemolysis type II hypersensitivity]

                        <h3 class="text-2xl font-semibold mt-6 mb-3">1. Eziopatogenesi e Classificazione</h3>
                        <p>Il meccanismo √® un'<strong>Ipersensibilit√† di Tipo II</strong>. Pu√≤ essere:</p>
                        <ul class="list-disc pl-6 space-y-1">
                            <li><strong>Primaria (Idiopatica):</strong> Nessuna causa sottostante. Comune nel Cocker Spaniel, Barboncino, Old English Sheepdog.</li>
                            <li><strong>Secondaria:</strong>
                                <ul class="list-disc pl-6 text-sm text-red-800">
                                    <li><em>Infettiva (Molto Comune!):</em> Ehrlichiosi, Anaplasmosi, Leishmania, Babesia, Rickettsiosi.</li>
                                    <li><em>Farmaci:</em> Sulfamidici, Cefalosporine.</li>
                                    <li><em>Neoplasia:</em> Linfoma, Emangiosarcoma.</li>
                                </ul>
                            </li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">2. Quadro Clinico</h3>
                        <p>I segni clinici sono tipici di un difetto dell'<strong>emostasi primaria</strong>:</p>
                        <ul class="list-disc pl-6 space-y-2 mt-2">
                            <li><strong>Petecchie e Ecchimosi:</strong> Su cute e mucose (gengive, padiglioni auricolari, addome).</li>
                            <li><strong>Sanguinamenti Mucosali:</strong> Epistassi, melena, ematuria, ematochezia.</li>
                            <li><strong>Ifema:</strong> Sangue nella camera anteriore dell'occhio.</li>
                        </ul>

                        <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 my-4">
                            <h4 class="font-bold text-red-800">La Soglia del Pericolo</h4>
                            <p>Il sanguinamento spontaneo si verifica tipicamente solo quando la conta piastrinica scende sotto <strong>30.000-50.000/¬µL</strong>. Valori pi√π alti raramente causano petecchie spontanee, suggerendo altre cause o errori di laboratorio.</p>
                        </div>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">3. Diagnosi</h3>
                        <p>√à una diagnosi di esclusione. Bisogna escludere tutte le cause secondarie.</p>
                        <ul class="list-disc pl-6 space-y-2 mt-2">
                            <li><strong>Emocromo e Striscio (Fondamentale):</strong> Confermare la trombocitopenia reale ed escludere la <strong>Pseudotrombocitopenia</strong> da aggregati piastrinici (comune nei prelievi difficili o in EDTA).</li>
                            <li><strong>Test per malattie infettive:</strong> Sierologia/PCR per Ehrlichia, Anaplasma, Leishmania e Rickettsia.</li>
                            <li><strong>Coagulativo (PT/aPTT):</strong> Solitamente normali nell'IMTP pura. Se alterati, sospettare CID o avvelenamento da rodenticidi.</li>
                            <li><strong>Midollo Osseo:</strong> Solitamente mostra <strong>iperplasia megacariocitica</strong> (il midollo cerca di compensare), a meno che gli anticorpi non colpiscano anche i megacariociti.</li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">4. Terapia</h3>
                        <p>L'obiettivo √® fermare la distruzione piastrinica. La trasfusione di piastrine √® spesso inutile perch√© vengono distrutte in pochi minuti.</p>
                        <ol class="list-decimal pl-6 space-y-2 mt-2">
                            <li><strong>Immunosoppressione:</strong>
                                <ul class="list-disc pl-6 text-sm text-red-800">
                                    <li><em>Steroidi:</em> Prednisolone (2-4 mg/kg/die).</li>
                                    <li><em>Seconda linea:</em> Ciclosporina, Micofenolato, Azatioprina.</li>
                                </ul>
                            </li>
                            <li><strong>Vincristina (Dose singola):</strong> Un chemioterapico che, a basso dosaggio, stimola il rilascio rapido di piastrine dai megacariociti e ne induce la frammentazione. Utile nella fase acuta per alzare la conta rapidamente.</li>
                            <li><strong>Melatonina:</strong> Talvolta usata come adiuvante.</li>
                            <li><strong>Gastrotezione:</strong> Se necessario per prevenire ulcere da steroidi (Omeprazolo).</li>
                        </ol>`,
                    en: `<p><strong>IMTP (Immune-Mediated Thrombocytopenia)</strong> is a condition where antibodies (usually IgG) bind to platelet surface antigens, causing their premature destruction in the reticuloendothelial system (mainly spleen). It is the most common cause of severe thrombocytopenia in dogs.</p>
                        
                        [Image of mechanism of immune mediated hemolysis type II hypersensitivity]

                        <h3 class="text-2xl font-semibold mt-6 mb-3">1. Pathogenesis and Classification</h3>
                        <p>The mechanism is a <strong>Type II Hypersensitivity</strong>. It can be:</p>
                        <ul class="list-disc pl-6 space-y-1">
                            <li><strong>Primary (Idiopathic):</strong> No underlying cause. Common in Cocker Spaniels, Poodles, Old English Sheepdogs.</li>
                            <li><strong>Secondary:</strong>
                                <ul class="list-disc pl-6 text-sm text-red-800">
                                    <li><em>Infectious (Very Common!):</em> Ehrlichiosis, Anaplasmosis, Leishmania, Babesia, Rickettsia.</li>
                                    <li><em>Drugs:</em> Sulfonamides, Cephalosporins.</li>
                                    <li><em>Neoplasia:</em> Lymphoma, Hemangiosarcoma.</li>
                                </ul>
                            </li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">2. Clinical Picture</h3>
                        <p>Clinical signs are typical of a <strong>primary hemostasis</strong> defect:</p>
                        <ul class="list-disc pl-6 space-y-2 mt-2">
                            <li><strong>Petechiae and Ecchymoses:</strong> On skin and mucous membranes (gums, ear pinnae, abdomen).</li>
                            <li><strong>Mucosal Bleeding:</strong> Epistaxis, melena, hematuria, hematochezia.</li>
                            <li><strong>Hyphema:</strong> Blood in the anterior chamber of the eye.</li>
                        </ul>

                        <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 my-4">
                            <h4 class="font-bold text-red-800">The Danger Threshold</h4>
                            <p>Spontaneous bleeding typically occurs only when platelet counts drop below <strong>30,000-50,000/¬µL</strong>. Higher values rarely cause spontaneous petechiae, suggesting other causes or lab errors.</p>
                        </div>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">3. Diagnosis</h3>
                        <p>It is a diagnosis of exclusion. All secondary causes must be ruled out.</p>
                        <ul class="list-disc pl-6 space-y-2 mt-2">
                            <li><strong>CBC and Smear (Crucial):</strong> Confirm real thrombocytopenia and rule out <strong>Pseudothrombocytopenia</strong> due to platelet clumps (common in difficult draws or EDTA).</li>
                            <li><strong>Infectious Disease Tests:</strong> Serology/PCR for Ehrlichia, Anaplasma, Leishmania, and Rickettsia.</li>
                            <li><strong>Coagulation (PT/aPTT):</strong> Usually normal in pure IMTP. If altered, suspect DIC or rodenticide poisoning.</li>
                            <li><strong>Bone Marrow:</strong> Usually shows <strong>megakaryocytic hyperplasia</strong> (marrow tries to compensate), unless antibodies also target megakaryocytes.</li>
                        </ul>

                        <h3 class="text-2xl font-semibold mt-6 mb-3">4. Therapy</h3>
                        <p>The goal is to stop platelet destruction. Platelet transfusion is often useless as they are destroyed within minutes.</p>
                        <ol class="list-decimal pl-6 space-y-2 mt-2">
                            <li><strong>Immunosuppression:</strong>
                                <ul class="list-disc pl-6 text-sm text-red-800">
                                    <li><em>Steroids:</em> Prednisolone (2-4 mg/kg/day).</li>
                                    <li><em>Second line:</em> Cyclosporine, Mycophenolate, Azathioprine.</li>
                                </ul>
                            </li>
                            <li><strong>Vincristine (Single dose):</strong> A chemotherapeutic agent that, at low doses, stimulates rapid platelet release from megakaryocytes and induces their fragmentation. Useful in the acute phase to raise counts quickly.</li>
                            <li><strong>Melatonin:</strong> Sometimes used as an adjuvant.</li>
                            <li><strong>Gastroprotection:</strong> If necessary to prevent steroid ulcers (Omeprazole).</li>
                        </ol>`
                },
                infographicTitle: { it: "Infografica Riepilogativa", en: "Summary Infographic" },
                infographicLinkTitle: { it: "Visualizza l'Infografica Dettagliata", en: "View the Detailed Infographic" },
                infographicLinkDesc: { it: "Schema visivo: Soglia di pericolo, Diagnosi differenziale e Terapia.", en: "Visual guide: Danger threshold, Differential Diagnosis and Therapy." },
                quizTitle: { it: "Quiz di Autovalutazione", en: "Self-Assessment Quiz" },
                quizSubmit: { it: "Verifica Risposte", en: "Check Answers" },
                audioTitle: { it: "Ascolta il Riassunto", en: "Listen to the Summary" },
                btnDownloadAudio: { it: "Scarica", en: "Download" },
                audioListen: { it: "Ascolta il riassunto completo", en: "Listen to the full summary" },
                audioDesc: { it: "Audio lezione sintetica.", en: "Short audio lesson." },
                bibliographyTitle: { it: "Riferimenti Bibliografici", en: "Bibliographical References" },
                bibliographyContent: { 
                    it: `<li>Ettinger SJ, Feldman EC, C√¥t√© E, Textbook of Veterinary Internal Medicine, 9th Edition, Elsevier, 2024.</li><li>Nelson RW, Couto CG. Small Animal Internal Medicine, 6th Ed. Elsevier, 2019.</li><li>Day MJ, Kohn B. BSAVA Manual of Canine and Feline Haematology and Transfusion Medicine. 2nd ed. BSAVA, 2012.</li>`,
                    en: `<li>Ettinger SJ, Feldman EC, C√¥t√© E, Textbook of Veterinary Internal Medicine, 9th Edition, Elsevier, 2024.</li><li>Nelson RW, Couto CG. Small Animal Internal Medicine, 6th Ed. Elsevier, 2019.</li><li>Day MJ, Kohn B. BSAVA Manual of Canine and Feline Haematology and Transfusion Medicine. 2nd ed. BSAVA, 2012.</li>`
                },
                btnPrint: { it: "Stampa Riassunto", en: "Print Summary" },
                accessibility: { it: "Accessibilit√†", en: "Accessibility" },
                "footer-credit": { it: "A cura della Prof.ssa Sara Busechian. Insegnamenti di clinica medica veterinaria", en: "Curated by Prof. Sara Busechian. Veterinary clinical medicine teachings" }
            };

            const quizData = {
                it: [
                    { question: "Quale tipo di ipersensibilit√† media l'IMTP?", options: ["Tipo I", "Tipo II", "Tipo III", "Tipo IV"], answer: "Tipo II" },
                    { question: "Qual √® il segno clinico mucosale pi√π caratteristico dell'IMTP?", options: ["Pustole", "Alopecia", "Petecchie", "Noduli"], answer: "Petecchie" },
                    { question: "Quale condizione va sempre esclusa tramite esame dello striscio ematico?", options: ["Aggregati piastrinici (Pseudotrombocitopenia)", "Anemia", "Leucocitosi", "Parassiti intestinali"], answer: "Aggregati piastrinici (Pseudotrombocitopenia)" },
                    { question: "Sotto quale conta piastrinica ci aspettiamo sanguinamenti spontanei gravi?", options: ["150.000-200.000/¬µL", "30.000-50.000/¬µL", "80.000-100.000/¬µL", "200.000-300.000/¬µL"], answer: "30.000-50.000/¬µL" },
                    { question: "Perch√© si usa la Vincristina nel trattamento dell'IMTP?", options: ["√à un antibiotico", "Stimola il rilascio rapido di piastrine dai megacariociti", "Sopprime il sistema immunitario a lungo termine", "Previene il vomito"], answer: "Stimola il rilascio rapido di piastrine dai megacariociti" },
                    { question: "Quale malattia infettiva √® una causa comune di trombocitopenia secondaria nel cane?", options: ["Parvovirus", "Ehrlichiosi", "Rabbia", "Cimurro"], answer: "Ehrlichiosi" },
                    { question: "Cosa ci aspettiamo di trovare nel midollo osseo in un caso di IMTP classica?", options: ["Aplasia (assenza di cellule)", "Iperplasia megacariocitica", "Infiltrazione tumorale", "Fibrosi"], answer: "Iperplasia megacariocitica" },
                    { question: "Come sono solitamente PT e aPTT nell'IMTP non complicata?", options: ["Normali", "Allungati", "Accorciati", "Non misurabili"], answer: "Normali" },
                    { question: "Cos'√® la Sindrome di Evans?", options: ["IMTP + IMHA concomitanti", "IMTP + Insufficienza renale", "IMTP + Epatite", "IMTP + Pancreatite"], answer: "IMTP + IMHA concomitanti" },
                    { question: "Quale farmaco √® comunemente usato come immunosoppressore di seconda linea?", options: ["Amoxicillina", "Ciclosporina", "Furosemide", "Metoclopramide"], answer: "Ciclosporina" }
                ],
                en: [
                    { question: "Which type of hypersensitivity mediates IMTP?", options: ["Type I", "Type II", "Type III", "Type IV"], answer: "Type II" },
                    { question: "What is the most characteristic mucosal clinical sign of IMTP?", options: ["Pustules", "Alopecia", "Petechiae", "Nodules"], answer: "Petechiae" },
                    { question: "Which condition must always be ruled out via blood smear examination?", options: ["Platelet clumps (Pseudothrombocytopenia)", "Anemia", "Leukocytosis", "Intestinal parasites"], answer: "Platelet clumps (Pseudothrombocytopenia)" },
                    { question: "Below which platelet count do we expect severe spontaneous bleeding?", options: ["150,000-200,000/¬µL", "30,000-50,000/¬µL", "80,000-100,000/¬µL", "200,000-300,000/¬µL"], answer: "30,000-50,000/¬µL" },
                    { question: "Why is Vincristine used in the treatment of IMTP?", options: ["It is an antibiotic", "It stimulates rapid platelet release from megakaryocytes", "It suppresses the immune system long-term", "It prevents vomiting"], answer: "It stimulates rapid platelet release from megakaryocytes" },
                    { question: "Which infectious disease is a common cause of secondary thrombocytopenia in dogs?", options: ["Parvovirus", "Ehrlichiosis", "Rabies", "Distemper"], answer: "Ehrlichiosis" },
                    { question: "What do we expect to find in the bone marrow in a classic IMTP case?", options: ["Aplasia (absence of cells)", "Megakaryocytic hyperplasia", "Tumor infiltration", "Fibrosis"], answer: "Megakaryocytic hyperplasia" },
                    { question: "How are PT and aPTT usually in uncomplicated IMTP?", options: ["Normal", "Prolonged", "Shortened", "Not measurable"], answer: "Normal" },
                    { question: "What is Evans Syndrome?", options: ["Concurrent IMTP + IMHA", "IMTP + Renal failure", "IMTP + Hepatitis", "IMTP + Pancreatitis"], answer: "Concurrent IMTP + IMHA" },
                    { question: "Which drug is commonly used as a second-line immunosuppressant?", options: ["Amoxicillin", "Cyclosporine", "Furosemide", "Metoclopramide"], answer: "Cyclosporine" }
                ]
            };
            
            // --- ROBUST TTS SCRIPT ---
            let currentLanguage = localStorage.getItem('language') || 'it';
            const synth = window.speechSynthesis;
            let currentUtterance = null;
            let activeTTSButton = null;

            function stopSpeech() {
                if (synth.speaking || synth.paused) {
                    synth.cancel();
                }
                if (activeTTSButton) {
                    activeTTSButton.classList.remove('playing');
                    activeTTSButton = null;
                }
                currentUtterance = null;
            }

            function speak(text, button) {
                if (activeTTSButton === button) {
                    if (synth.paused) {
                        synth.resume();
                        button.classList.add('playing');
                    } else if (synth.speaking) {
                        synth.pause();
                        button.classList.remove('playing');
                    }
                    return;
                }

                stopSpeech();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = currentLanguage === 'it' ? 'it-IT' : 'en-US';
                
                utterance.onstart = () => {
                    activeTTSButton = button;
                    button.classList.add('playing');
                };
                
                utterance.onend = () => {
                    if (activeTTSButton === button) {
                        button.classList.remove('playing');
                        activeTTSButton = null;
                        currentUtterance = null;
                    }
                };

                utterance.onerror = (e) => {
                    if (e.error !== 'interrupted' && e.error !== 'canceled') {
                        console.error('TTS Error:', e);
                    }
                    if (activeTTSButton === button) {
                        button.classList.remove('playing');
                        activeTTSButton = null;
                        currentUtterance = null;
                    }
                };

                currentUtterance = utterance;
                synth.speak(utterance);
            }

            window.addEventListener('beforeunload', stopSpeech);

            let sound = null;
            function initHowler() {
                const audioFile = document.querySelector('#audio a[download]').href;
                if (!audioFile) return;
                sound = new Howl({
                    src: [audioFile], html5: true, 
                    onplay: () => { playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden'); },
                    onpause: () => { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); },
                    onend: () => { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); },
                    onloaderror: (id, msg) => { console.error("Error loading audio:", msg); },
                    onplayerror: (id, msg) => { console.error("Error playing audio:", msg); }
                });
            }

            const playPauseBtn = document.getElementById('audio-play-pause');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            if(playPauseBtn) playPauseBtn.addEventListener('click', () => {
                if (!sound) initHowler();
                if(sound) { if (sound.playing()) sound.pause(); else sound.play(); }
            });

            function setupTTSListeners() {
                document.querySelectorAll('.tts-button').forEach(button => {
                    const newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                    newButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        let textToRead = '';
                        const parentElement = newButton.parentElement;

                        if (parentElement.tagName === 'H1' && parentElement.dataset.langKey === 'pageTitle') {
                            const titleClone = parentElement.cloneNode(true);
                            titleClone.querySelector('.tts-button').remove();
                            textToRead = titleClone.textContent.trim();
                            const subtitle = parentElement.nextElementSibling;
                            if(subtitle && subtitle.dataset.langKey === 'pageSubtitle') {
                                textToRead += '. ' + subtitle.textContent.trim();
                            }
                        }
                        else if (parentElement.tagName === 'H2') {
                            const section = parentElement.closest('section');
                            const titleClone = parentElement.cloneNode(true);
                            titleClone.querySelector('.tts-button').remove();
                            textToRead = titleClone.textContent.trim();

                            if (section && section.id === 'riassunto') {
                                const content = section.querySelector('[data-lang-key="summaryContent"]');
                                if (content) {
                                    const contentClone = content.cloneNode(true);
                                    textToRead += '. ' + contentClone.textContent.trim().replace(/\s\s+/g, ' ');
                                }
                            }
                        }
                        else if (parentElement.tagName === 'H3' && parentElement.closest('.quiz-question')) {
                            const questionClone = parentElement.cloneNode(true);
                            questionClone.querySelector('.tts-button').remove();
                            textToRead = questionClone.textContent.trim();
                        }
                        else if (parentElement.classList.contains('quiz-option')) {
                            const label = parentElement.querySelector('label');
                            const textSpan = label.querySelector('span');
                            textToRead = textSpan ? textSpan.textContent.trim() : label.textContent.trim();
                        }

                        if (textToRead) speak(textToRead, newButton);
                    });
                });
            }

            function loadQuiz(lang) {
                const quizContainer = document.getElementById('quiz-container');
                if(!quizContainer) return;
                quizContainer.innerHTML = '';
                document.getElementById('quiz-results').innerHTML = ''; 
                quizData[lang].forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'quiz-question p-4 rounded-lg';
                    let optionsHtml = q.options.map(o => `
                        <li class="quiz-option p-2 rounded hover:bg-red-50 flex items-center justify-between">
                            <label class="flex items-center w-full cursor-pointer flex-grow">
                                <input type="radio" name="q${index}" value="${o}" class="mr-3">
                                <span>${o}</span>
                            </label>
                            <span class="tts-button flex-shrink-0 ml-2 text-gray-400 hover:text-red-600" title="Ascolta risposta"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span>
                        </li>`).join('');
                    questionDiv.innerHTML = `<h3 class="font-semibold mb-2 inline-flex items-center text-lg">${index + 1}. ${q.question}<span class="tts-button ml-2"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z"/></svg></span></h3><ul class="space-y-1">${optionsHtml}</ul>`;
                    quizContainer.appendChild(questionDiv);
                });
                setupTTSListeners();
            }

            function updateLanguage(lang) {
                document.documentElement.lang = lang;
                document.getElementById('lang-toggle').textContent = lang === 'it' ? 'EN' : 'IT';
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[key] && translations[key][lang]) {
                        if (key.includes('Content')) {
                            element.innerHTML = translations[key][lang];
                        } else {
                            const ttsButton = element.querySelector('.tts-button');
                            const textNode = [...element.childNodes].find(node => node.nodeType === Node.TEXT_NODE && node.textContent.trim());
                            if (textNode) {
                                textNode.textContent = translations[key][lang];
                            } else {
                                element.textContent = translations[key][lang];
                            }
                            if(ttsButton) element.appendChild(ttsButton);
                        }
                    }
                });
                
                const dsaToggle = document.getElementById('accessibility-toggle');
                if (document.body.classList.contains('dsa-mode')) {
                    dsaToggle.textContent = lang === 'it' ? 'Vista Standard' : 'Standard View';
                } else {
                    dsaToggle.textContent = lang === 'it' ? 'Accessibilit√†' : 'Accessibility';
                }
                loadQuiz(lang);
                setupTTSListeners();
            }
            
            document.getElementById('lang-toggle').addEventListener('click', () => {
                currentLanguage = currentLanguage === 'it' ? 'en' : 'it';
                localStorage.setItem('language', currentLanguage);
                stopSpeech();
                updateLanguage(currentLanguage);
            });

            const dsaToggle = document.getElementById('accessibility-toggle');
            dsaToggle.addEventListener('click', () => {
                document.body.classList.toggle('dsa-mode');
                 if (document.body.classList.contains('dsa-mode')) {
                    dsaToggle.textContent = currentLanguage === 'it' ? 'Vista Standard' : 'Standard View';
                } else {
                    dsaToggle.textContent = currentLanguage === 'it' ? 'Accessibilit√†' : 'Accessibility';
                }
            });

            const submitQuizBtn = document.getElementById('submit-quiz');
            if (submitQuizBtn) submitQuizBtn.addEventListener('click', () => {
                let score = 0;
                const questions = document.querySelectorAll('.quiz-question');
                quizData[currentLanguage].forEach((q, index) => {
                    const selected = document.querySelector(`input[name="q${index}"]:checked`);
                    questions[index].classList.remove('correct', 'incorrect');
                    if (selected) {
                        if (selected.value === q.answer) {
                            score++;
                            questions[index].classList.add('correct');
                        } else {
                            questions[index].classList.add('incorrect');
                        }
                    } else {
                        questions[index].classList.add('incorrect');
                    }
                });
                const resultsContainer = document.getElementById('quiz-results');
                const resultText = {
                    it: `Hai risposto correttamente a ${score} su ${quizData.it.length} domande.`,
                    en: `You answered ${score} out of ${quizData.en.length} questions correctly.`
                };
                resultsContainer.textContent = resultText[currentLanguage];
            });
            
            updateLanguage(currentLanguage);
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('article section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                        });
                    }
                });
            }, { rootMargin: "-50% 0px -50% 0px" });
            sections.forEach(sec => observer.observe(sec));
        });
    </script>
</body>
</html>
